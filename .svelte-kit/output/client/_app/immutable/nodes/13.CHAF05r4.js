import"../chunks/DsnmJJEf.js";import"../chunks/luk3gl1z.js";import{o as $t}from"../chunks/_gNL4IXV.js";import{p as te,f as x,a as G,b as c,c as ee,s as i,d as r,e as a,m as o,g as t,r as s,w as _t,v as ae,t as L,u as S,n as gt}from"../chunks/CwLoShKX.js";import{e as O,s as f}from"../chunks/D8bngpjW.js";import{i as U}from"../chunks/WMMc_YU6.js";import{e as se}from"../chunks/ThBeqclG.js";import{r as I}from"../chunks/CkmYFb5S.js";import{s as re}from"../chunks/DIJ89BUl.js";import{b as yt,a as ht}from"../chunks/DGOQ8hUW.js";import{i as le}from"../chunks/Ccxz8Bhd.js";import{p as ie}from"../chunks/DeyUZ0zj.js";import{w as oe,o as ne,v as de,t as Tt}from"../chunks/Q6rjOpry.js";var ce=x('<p class="text-slate-600">Cargando…</p>'),ue=x('<p class="text-rose-600"> </p>'),ve=x('<div class="grid grid-cols-1 md:grid-cols-2 gap-4"><label class="block"><span class="block text-xs text-slate-600 mb-1">Usuario</span> <input class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70"/></label> <label class="block"><span class="block text-xs text-slate-600 mb-1">Email</span> <input type="email" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70"/></label> <div class="flex items-center gap-5 md:col-span-2"><label class="inline-flex items-center gap-2"><input type="checkbox"/> <span class="text-sm text-slate-700">Activo</span></label> <label class="inline-flex items-center gap-2"><input type="checkbox"/> <span class="text-sm text-slate-700">Staff</span></label> <label class="inline-flex items-center gap-2"><input type="checkbox"/> <span class="text-sm text-slate-700">Superuser</span></label></div> <div class="md:col-span-2 flex items-center justify-end gap-2"><button class="rounded-lg px-3 py-2 ring-1 ring-slate-300 hover:bg-slate-50">Deshacer cambios</button> <button class="rounded-lg px-4 py-2 bg-slate-900 text-white hover:bg-black disabled:opacity-60"> </button></div></div> <div class="mt-6 rounded-xl border border-slate-200 p-4"><h3 class="font-semibold text-slate-900">Cambiar contraseña</h3> <div class="mt-3 flex flex-col sm:flex-row items-start sm:items-center gap-3"><input type="password" class="w-full sm:w-80 rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70" placeholder="Nueva contraseña"/> <button class="rounded-lg px-4 py-2 bg-amber-600 text-white hover:bg-amber-700 disabled:opacity-60"> </button></div></div>',1),pe=x('<p class="text-slate-600">Cargando pedidos…</p>'),me=x('<p class="text-slate-600">Sin pedidos registrados.</p>'),fe=x('<tr><td class="px-3 py-2 font-medium text-slate-900"> </td><td class="px-3 py-2"> </td><td class="px-3 py-2"> </td><td class="px-3 py-2"> </td><td class="px-3 py-2"> </td></tr>'),be=x('<div class="overflow-x-auto"><table class="min-w-full text-sm"><thead class="bg-slate-50"><tr class="text-left text-slate-600"><th class="px-3 py-2 font-semibold">#</th><th class="px-3 py-2 font-semibold">Fecha</th><th class="px-3 py-2 font-semibold">Estado</th><th class="px-3 py-2 font-semibold">Total</th><th class="px-3 py-2 font-semibold">Email</th></tr></thead><tbody class="divide-y divide-slate-200"></tbody></table></div> <div class="mt-4 flex items-center justify-end gap-2"><button class="rounded-lg px-3 py-1.5 ring-1 ring-slate-300 disabled:opacity-50">← Anterior</button> <button class="rounded-lg px-3 py-1.5 ring-1 ring-slate-300 disabled:opacity-50">Siguiente →</button></div>',1),xe=x('<div class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50"><div> </div></div>'),_e=x('<div class="mx-auto max-w-7xl px-4 py-6 space-y-6"><div class="flex items-center justify-between"><div><h1 class="text-2xl md:text-3xl font-semibold text-slate-900">Usuario</h1> <p class="text-slate-600 mt-1">Detalle y pedidos del cliente.</p></div> <div class="flex items-center gap-2"><a href="/admin/users" class="rounded-xl px-3 py-2 ring-1 ring-slate-300 hover:bg-slate-50 text-sm">← Volver</a> <button class="rounded-xl bg-rose-600 text-white px-3 py-2 text-sm hover:bg-rose-700">Eliminar</button></div></div> <div class="rounded-2xl border border-slate-200 bg-white p-5"><!></div> <div class="rounded-2xl border border-slate-200 bg-white"><div class="flex items-center justify-between px-5 py-4 border-b border-slate-200"><h2 class="text-lg font-semibold text-slate-900">Pedidos de este usuario</h2> <div class="text-sm text-slate-600"><!></div></div> <div class="p-5"><!></div></div></div> <!>',1);function Te(Dt,wt){te(wt,!1);let kt=ie(wt,"params",8),it=o(!0),H=o(""),b=o(null),J=o(""),K=o(""),Q=o(!0),W=o(!1),X=o(!1),M=o(!1),Y=o(""),$=o(!1),ot=o(!0),p=o([]),_=o(0),E=o(null),nt=null,m=o(1);const R=12;let tt=o(""),St=o("ok"),Ut=null;function g(e,l="ok"){a(tt,e),a(St,l),clearTimeout(Ut),Ut=setTimeout(()=>a(tt,""),3e3)}$t(async()=>{await dt(),await ct()});async function dt(){a(it,!0),a(H,"");try{const e=await oe(Number(kt().id));a(b,e),a(J,e.username),a(K,e.email),a(Q,!!e.is_active),a(W,!!e.is_staff),a(X,!!e.is_superuser)}catch(e){a(H,String(e?.message??e))}finally{a(it,!1)}}async function jt(){if(t(b)){a(M,!0);try{await Tt(t(b).id,{username:t(J).trim(),email:t(K).trim(),is_active:t(Q),is_staff:t(W),is_superuser:t(X)}),g("Usuario actualizado."),await dt()}catch(e){g(String(e?.message??e),"err")}finally{a(M,!1)}}}async function Ft(){if(!t(b))return;const e=t(Y).trim();if(!e){g("Escribe una nueva contraseña","err");return}a($,!0);try{await Tt(t(b).id,{password:e}),a(Y,""),g("Contraseña actualizada.")}catch(l){g(String(l?.message??l),"err")}finally{a($,!1)}}async function Gt(){if(t(b)&&confirm(`¿Eliminar usuario "${t(b).username}"?`))try{await de(t(b).id),g("Usuario eliminado."),window.location.href="/admin/users"}catch(e){g(String(e?.message??e),"err")}}async function ct(){a(ot,!0);try{const e=await ne({user_id:Number(kt().id),page:t(m),page_size:R});if(Array.isArray(e))a(p,e),a(_,e.length),a(E,nt=null);else{const l=e;a(p,l.results),a(_,l.count??t(p).length),a(E,l.next??null),nt=l.previous??null}}catch(e){g(String(e?.message??e),"err"),a(p,[]),a(_,0),a(E,nt=null)}finally{a(ot,!1)}}function Lt(){t(m)>1&&(a(m,t(m)-1),ct())}function Ot(){(t(E)||t(p).length===R&&t(_)>t(m)*R)&&(a(m,t(m)+1),ct())}const It=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0});function Mt(e){const l=typeof e=="number"?e:parseFloat(String(e??0));return isNaN(l)?"—":It.format(l)}le();var Et=_e(),ut=G(Et),vt=r(ut),At=i(r(vt),2),Rt=i(r(At),2);s(At),s(vt);var pt=i(vt,2),Vt=r(pt);{var Zt=e=>{var l=ce();c(e,l)},qt=e=>{var l=_t(),y=G(l);{var V=d=>{var u=ue(),h=r(u,!0);s(u),L(()=>f(h,t(H))),c(d,u)},ft=d=>{var u=_t(),h=G(u);{var et=A=>{var Z=ve(),w=G(Z),N=r(w),z=i(r(N),2);I(z),s(N);var n=i(N,2),C=i(r(n),2);I(C),s(n);var k=i(n,2),q=r(k),P=r(q);I(P),gt(2),s(q);var B=i(q,2),T=r(B);I(T),gt(2),s(B);var at=i(B,2),D=r(at);I(D),gt(2),s(at),s(k);var st=i(k,2),j=r(st),F=i(j,2),bt=r(F,!0);s(F),s(st),s(w);var rt=i(w,2),Pt=i(r(rt),2),xt=r(Pt);I(xt);var lt=i(xt,2),Yt=r(lt,!0);s(lt),s(Pt),s(rt),L(()=>{j.disabled=t(M),F.disabled=t(M),f(bt,t(M)?"Guardando…":"Guardar cambios"),lt.disabled=t($),f(Yt,t($)?"Actualizando…":"Actualizar contraseña")}),yt(z,()=>t(J),v=>a(J,v)),yt(C,()=>t(K),v=>a(K,v)),ht(P,()=>t(Q),v=>a(Q,v)),ht(T,()=>t(W),v=>a(W,v)),ht(D,()=>t(X),v=>a(X,v)),O("click",j,dt),O("click",F,jt),yt(xt,()=>t(Y),v=>a(Y,v)),O("click",lt,Ft),c(A,Z)};U(h,A=>{t(b)&&A(et)},!0)}c(d,u)};U(y,d=>{t(H)?d(V):d(ft,!1)},!0)}c(e,l)};U(Vt,e=>{t(it)?e(Zt):e(qt,!1)})}s(pt);var Nt=i(pt,2),mt=r(Nt),zt=i(r(mt),2),Bt=r(zt);{var Ht=e=>{var l=ae();L(()=>f(l,`Total: ${t(_)??""}`)),c(e,l)};U(Bt,e=>{t(_)&&e(Ht)})}s(zt),s(mt);var Ct=i(mt,2),Jt=r(Ct);{var Kt=e=>{var l=pe();c(e,l)},Qt=e=>{var l=_t(),y=G(l);{var V=d=>{var u=me();c(d,u)},ft=d=>{var u=be(),h=G(u),et=r(h),A=i(r(et));se(A,5,()=>t(p),z=>z.id,(z,n)=>{var C=fe(),k=r(C),q=r(k,!0);s(k);var P=i(k),B=r(P,!0);s(P);var T=i(P),at=r(T,!0);s(T);var D=i(T),st=r(D,!0);s(D);var j=i(D),F=r(j,!0);s(j),s(C),L((bt,rt)=>{f(q,(t(n),S(()=>t(n).number??t(n).id))),f(B,bt),f(at,(t(n),S(()=>t(n).status))),f(st,rt),f(F,(t(n),S(()=>t(n).email)))},[()=>(t(n),S(()=>new Date(t(n).created_at).toLocaleString())),()=>(t(n),S(()=>Mt(t(n).total)))]),c(z,C)}),s(A),s(et),s(h);var Z=i(h,2),w=r(Z),N=i(w,2);s(Z),L(()=>{w.disabled=t(m)<=1,N.disabled=(t(E),t(p),t(_),t(m),S(()=>!(t(E)||t(p).length===R&&t(_)>t(m)*R)))}),O("click",w,Lt),O("click",N,Ot),c(d,u)};U(y,d=>{t(p),S(()=>t(p).length===0)?d(V):d(ft,!1)},!0)}c(e,l)};U(Jt,e=>{t(ot)?e(Kt):e(Qt,!1)})}s(Ct),s(Nt),s(ut);var Wt=i(ut,2);{var Xt=e=>{var l=xe(),y=r(l),V=r(y,!0);s(y),s(l),L(()=>{re(y,1,`rounded-xl px-4 py-2 text-sm shadow
                ${t(St)==="ok"?"bg-emerald-600 text-white":"bg-rose-600 text-white"}`),f(V,t(tt))}),c(e,l)};U(Wt,e=>{t(tt)&&e(Xt)})}O("click",Rt,Gt),c(Dt,Et),ee()}export{Te as component};
