import"../chunks/DsnmJJEf.js";import"../chunks/luk3gl1z.js";import{o as Ae}from"../chunks/_gNL4IXV.js";import{p as Ee,w as N,a as L,b as a,c as Ie,e as c,m as O,g as t,f as l,d as i,r,t as T,s as v}from"../chunks/CwLoShKX.js";import{s as f,e as qe}from"../chunks/D8bngpjW.js";import{i as x}from"../chunks/WMMc_YU6.js";import{e as K,i as oe}from"../chunks/ThBeqclG.js";import{s as Oe}from"../chunks/DIJ89BUl.js";import{i as Te}from"../chunks/Ccxz8Bhd.js";import{s as ze,a as Fe}from"../chunks/DH8C1yjn.js";import{u as De}from"../chunks/C-KkEP16.js";import{t as Q,a as Je}from"../chunks/wZ8Uf4_x.js";var Me=l('<section class="max-w-lg mx-auto bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mt-4"><h1 class="text-xl font-semibold text-slate-900 mb-2">Inicia sesión para ver tus pedidos</h1> <p class="text-sm text-slate-600 mb-4">Aquí podrás revisar el estado de tus compras y simular el pago de prueba.</p> <a href="/login" class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium bg-amber-600 text-white hover:bg-amber-700">Ir a iniciar sesión</a></section>'),Re=l('<div class="h-24 rounded-2xl bg-slate-100 animate-pulse"></div>'),Be=l('<div class="space-y-3"></div>'),Ve=l('<div class="rounded-2xl border border-rose-100 bg-rose-50 px-4 py-3 text-sm text-rose-700"> </div>'),We=l('<div class="rounded-2xl border border-slate-200 bg-white px-6 py-10 text-center text-sm text-slate-600"><p class="font-medium text-slate-800 mb-1">Todavía no tienes pedidos.</p> <p class="mb-4">Cuando realices una compra, podrás ver aquí el estado y el historial.</p> <a href="/productos" class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium bg-amber-600 text-white hover:bg-amber-700">Ver productos</a></div>'),Xe=l('<p class="text-xs text-slate-700"> <span class="text-slate-500"> </span></p>'),Ge=l('<div class="mt-3 space-y-1"></div>'),He=l('<button type="button" class="inline-flex items-center justify-center rounded-xl px-3 py-1.5 text-xs sm:text-sm font-medium bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-60"> </button>'),Ke=l('<p class="text-[11px] text-emerald-700">Esta orden ya está pagada.</p>'),Qe=l('<p class="text-[11px] text-rose-700">Esta orden fue cancelada.</p>'),Ue=l('<article class="rounded-2xl border border-slate-200 bg-white px-4 py-4 sm:px-6 sm:py-5 shadow-sm"><div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between"><div><p class="text-xs text-slate-500">Pedido <span class="font-mono text-slate-800"> </span></p> <p class="text-xs text-slate-500"> </p> <!></div> <div class="flex flex-col items-end gap-2"><div class="flex items-center gap-2"><span><span class="h-1.5 w-1.5 rounded-full bg-current/80"></span> </span> <span class="text-sm font-semibold text-slate-900"> </span></div> <!></div></div></article>'),Ye=l('<div class="space-y-4"></div>'),Ze=l('<section class="max-w-5xl mx-auto mt-4 space-y-6"><!></section>');function mt(ne,le){Ee(le,!1);const[de,ce]=ze(),U=()=>Fe(De,"$user",de),Y="https://tienda-backend-rodrigo.azurewebsites.net".replace(/\/+$/,""),Z=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format;function pe(){return typeof document>"u"?"":document.cookie.split("; ").find(e=>e.startsWith("csrftoken="))?.split("=")[1]??""}let $=O(!0),S=O(""),g=O([]),A=O(null);Ae(me);async function me(){if(!U()?.authenticated){c($,!1),c(g,[]);return}c($,!0),c(S,"");try{const e=await fetch(`${Y}/api/my/orders/`,{credentials:"include"});if(!e.ok)throw new Error(await e.text());const s=await e.json();c(g,Array.isArray(s)?s:s.results??[])}catch(e){c(S,String(e?.message??e)||"No se pudieron cargar tus pedidos."),Q(t(S)),c(g,[])}finally{c($,!1)}}function ue(e){return e==="paid"?"Pagada":e==="pending"?"Pendiente":e==="cancelled"?"Cancelada":e}function ve(e){return e==="paid"?"bg-emerald-50 text-emerald-700 ring-emerald-200":e==="pending"?"bg-amber-50 text-amber-700 ring-amber-200":e==="cancelled"?"bg-rose-50 text-rose-700 ring-rose-200":"bg-slate-50 text-slate-600 ring-slate-200"}async function fe(e){if(!(e.status==="paid"||e.status==="cancelled")){c(A,e.id);try{const s=await fetch(`${Y}/api/my/orders/${e.id}/pay-mock/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":pe()},body:JSON.stringify({})});if(!s.ok){let p="No se pudo simular el pago.";try{const I=await s.json();p=I.detail||JSON.stringify(I)||p}catch{p=await s.text()||p}Q(p);return}const E=await s.json();c(g,t(g).map(p=>p.id===E.id?E:p)),Je("Pago de prueba realizado. La orden quedó como pagada.")}catch(s){Q(String(s?.message??s)||"Error al conectar con el servidor.")}finally{c(A,null)}}}Te();var ee=N(),xe=L(ee);{var ge=e=>{var s=Me();a(e,s)},_e=e=>{var s=Ze(),E=i(s);{var p=y=>{var h=Be();K(h,4,()=>Array(3),oe,(z,te)=>{var F=Re();a(z,F)}),r(h),a(y,h)},I=y=>{var h=N(),z=L(h);{var te=w=>{var k=Ve(),D=i(k,!0);r(k),T(()=>f(D,t(S))),a(w,k)},F=w=>{var k=N(),D=L(k);{var be=P=>{var j=We();a(P,j)},ye=P=>{var j=Ye();K(j,5,()=>t(g),J=>J.id,(J,n)=>{var M=Ue(),ae=i(M),R=i(ae),B=i(R),re=v(i(B)),he=i(re);r(re),r(B);var V=v(B,2),we=i(V);r(V);var ke=v(V,2);{var Pe=d=>{var o=Ge();K(o,5,()=>t(n).items,oe,(_,u)=>{var C=Xe(),m=i(C),b=v(m),X=i(b);r(b),r(C),T(G=>{f(m,`${t(u).qty??""}× ${(t(u).product_name||`Producto #${t(u).id}`)??""} `),f(X,` 
                          · ${G??""}`)},[()=>Z(Number(t(u).unit_price||0))]),a(_,C)}),r(o),a(d,o)};x(ke,d=>{t(n).items?.length&&d(Pe)})}r(R);var se=v(R,2),W=i(se),q=i(W),Se=v(i(q));r(q);var ie=v(q,2),je=i(ie,!0);r(ie),r(W);var Ce=v(W,2);{var Ne=d=>{var o=He(),_=i(o,!0);r(o),T(()=>{o.disabled=t(A)===t(n).id,f(_,t(A)===t(n).id?"Procesando…":"Pagar (prueba)")}),qe("click",o,()=>fe(t(n))),a(d,o)},Le=d=>{var o=N(),_=L(o);{var u=m=>{var b=Ke();a(m,b)},C=m=>{var b=N(),X=L(b);{var G=H=>{var $e=Qe();a(H,$e)};x(X,H=>{t(n).status==="cancelled"&&H(G)},!0)}a(m,b)};x(_,m=>{t(n).status==="paid"?m(u):m(C,!1)},!0)}a(d,o)};x(Ce,d=>{t(n).status==="pending"?d(Ne):d(Le,!1)})}r(se),r(ae),r(M),T((d,o,_,u)=>{f(he,`#${t(n).number??""}`),f(we,`Realizado el 
                  ${d??""}`),Oe(q,1,o),f(Se,` ${_??""}`),f(je,u)},[()=>new Date(t(n).created_at).toLocaleString("es-CL",{dateStyle:"short",timeStyle:"short"}),()=>`inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-medium ring-1 ${ve(t(n).status)}`,()=>ue(t(n).status),()=>Z(Number(t(n).total||0))]),a(J,M)}),r(j),a(P,j)};x(D,P=>{t(g).length?P(ye,!1):P(be)},!0)}a(w,k)};x(z,w=>{t(S)?w(te):w(F,!1)},!0)}a(y,h)};x(E,y=>{t($)?y(p):y(I,!1)})}r(s),a(e,s)};x(xe,e=>{U()?.authenticated?e(_e,!1):e(ge)})}a(ne,ee),Ie(),ce()}export{mt as component};
