import"../chunks/DsnmJJEf.js";import"../chunks/luk3gl1z.js";import{o as St}from"../chunks/_gNL4IXV.js";import{p as Et,f,a as xe,g as e,b as v,c as Ct,s as l,d as a,e as r,m as c,r as t,n as me,w as ot,t as T,v as At}from"../chunks/CwLoShKX.js";import{e as m,s as p}from"../chunks/D8bngpjW.js";import{i as S}from"../chunks/WMMc_YU6.js";import{e as nt}from"../chunks/ThBeqclG.js";import{r as U,s as jt}from"../chunks/CkmYFb5S.js";import{s as Re}from"../chunks/DIJ89BUl.js";import{b as Ae,a as fe}from"../chunks/DGOQ8hUW.js";import{i as Ut}from"../chunks/Ccxz8Bhd.js";import{s as Mt,t as Nt,u as Pt,v as Tt}from"../chunks/Q6rjOpry.js";var zt=f('<div class="p-6 flex items-center gap-3 text-slate-600"><span class="inline-block h-4 w-4 animate-spin rounded-full border-[2px] border-slate-300 border-t-slate-500"></span> <span>Cargando usuarios…</span></div>'),Bt=f('<div class="p-6"><div class="rounded-xl border border-rose-100 bg-rose-50 px-4 py-3 text-sm text-rose-700"> </div></div>'),Lt=f('<div class="p-8 flex flex-col items-center justify-center text-center gap-2"><div class="h-10 w-10 rounded-full bg-slate-100 flex items-center justify-center"><svg class="h-5 w-5 text-slate-400" viewBox="0 0 24 24" fill="none"><path d="M12 7V13" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"></path><circle cx="12" cy="16" r="0.8" fill="currentColor"></circle><circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="1.6"></circle></svg></div> <p class="text-slate-900 font-medium">No hay usuarios con los criterios actuales.</p> <p class="text-slate-500 text-sm">Prueba cambiando filtros o creando un nuevo usuario.</p></div>'),Dt=f('<span class="px-2 py-0.5 rounded-full font-medium bg-indigo-50 text-indigo-700 ring-1 ring-indigo-100">Staff</span>'),Gt=f('<span class="px-2 py-0.5 rounded-full font-medium bg-amber-50 text-amber-700 ring-1 ring-amber-100">Superuser</span>'),It=f('<div class="p-4 flex flex-col gap-3"><div class="flex items-start justify-between gap-3"><div><p class="font-semibold text-slate-900 text-sm"> </p> <p class="text-xs text-slate-500 break-all"> </p></div> <div class="flex flex-col items-end text-[11px] text-slate-700 gap-1"><span> </span> <!> <!></div></div> <div class="grid grid-cols-1 gap-1.5 text-[11px] text-slate-600 mt-1"><div><span class="font-medium text-slate-700">Creado:</span> <span> </span></div> <div><span class="font-medium text-slate-700">Último login:</span> <span> </span></div></div> <div class="mt-3 flex items-center gap-2"><button class="flex-1 rounded-lg px-3 py-1.5 ring-1 ring-slate-300 text-xs font-medium hover:bg-slate-50 transition-colors">Editar</button> <button class="flex-1 rounded-lg px-3 py-1.5 bg-rose-600 text-white text-xs font-medium hover:bg-rose-700 transition-colors">Eliminar</button></div></div>'),Vt=f('<span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-indigo-50 text-indigo-700 ring-1 ring-indigo-100">Sí</span>'),Zt=f('<span class="text-xs text-slate-500">No</span>'),qt=f('<span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-amber-50 text-amber-700 ring-1 ring-amber-100">Sí</span>'),Ft=f('<span class="text-xs text-slate-500">No</span>'),Ht=f('<tr class="hover:bg-slate-50/80 transition-colors"><td class="px-4 py-3 font-medium text-slate-900"> </td><td class="px-4 py-3 text-slate-700"> </td><td class="px-4 py-3"><span> </span></td><td class="px-4 py-3"><!></td><td class="px-4 py-3"><!></td><td class="px-4 py-3 text-slate-700"> </td><td class="px-4 py-3 text-slate-700"> </td><td class="px-4 py-3"><div class="flex items-center justify-end gap-2"><button class="rounded-lg px-3 py-1.5 text-xs font-medium ring-1 ring-slate-300 hover:bg-slate-50 transition-colors">Editar</button> <button class="rounded-lg px-3 py-1.5 text-xs font-medium bg-rose-600 text-white hover:bg-rose-700 transition-colors">Eliminar</button></div></td></tr>'),Jt=f('Mostrando página <span class="font-medium"> </span> · Total <span class="font-medium"> </span>',1),Kt=f('<div class="block md:hidden divide-y divide-slate-100"></div> <div class="hidden md:block overflow-x-auto"><table class="min-w-full text-sm"><thead class="bg-slate-50/80 border-b border-slate-200"><tr class="text-left text-slate-600"><th class="px-4 py-3 font-semibold text-xs uppercase tracking-wide">Usuario</th><th class="px-4 py-3 font-semibold text-xs uppercase tracking-wide">Email</th><th class="px-4 py-3 font-semibold text-xs uppercase tracking-wide">Activo</th><th class="px-4 py-3 font-semibold text-xs uppercase tracking-wide">Staff</th><th class="px-4 py-3 font-semibold text-xs uppercase tracking-wide">Superuser</th><th class="px-4 py-3 font-semibold text-xs uppercase tracking-wide">Creado</th><th class="px-4 py-3 font-semibold text-xs uppercase tracking-wide">Último login</th><th class="px-4 py-3 font-semibold text-xs uppercase tracking-wide text-right">Acciones</th></tr></thead><tbody class="divide-y divide-slate-100"></tbody></table></div> <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 px-4 py-4 border-t border-slate-200 text-sm bg-slate-50/60"><div class="text-slate-600"><!></div> <div class="flex items-center gap-2"><button class="rounded-lg px-3 py-1.5 ring-1 ring-slate-300 bg-white/80 hover:bg-slate-50 disabled:opacity-50 text-sm">← Anterior</button> <button class="rounded-lg px-3 py-1.5 ring-1 ring-slate-300 bg-white/80 hover:bg-slate-50 disabled:opacity-50 text-sm">Siguiente →</button></div></div>',1),Ot=f('<div class="fixed inset-0 z-50 grid place-items-center p-4"><div class="absolute inset-0 bg-black/40 backdrop-blur-sm" role="button" tabindex="0" aria-label="Cerrar modal"></div> <div class="relative w-full max-w-xl rounded-2xl bg-white shadow-2xl ring-1 ring-black/5 p-5 sm:p-6"><div class="flex items-start justify-between gap-3"><div><h2 class="text-lg font-semibold text-slate-900"> </h2> <p class="text-xs text-slate-500 mt-0.5"> </p></div> <button class="rounded-full p-1.5 hover:bg-slate-100" aria-label="Cerrar"><svg class="h-4 w-4 text-slate-500" viewBox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M6 6l12 12M18 6L6 18"></path></svg></button></div> <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4"><label class="block"><span class="block text-xs text-slate-600 mb-1">Usuario</span> <input class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70 focus:border-amber-400" placeholder="username"/></label> <label class="block"><span class="block text-xs text-slate-600 mb-1">Email</span> <input type="email" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70 focus:border-amber-400" placeholder="correo@dominio.com"/></label> <label class="block md:col-span-2"><span class="block text-xs text-slate-600 mb-1"> </span> <input type="password" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70 focus:border-amber-400"/></label> <div class="flex flex-wrap items-center gap-4 md:col-span-2"><label class="inline-flex items-center gap-2 text-sm text-slate-700"><input type="checkbox" class="rounded border-slate-300 text-slate-900 focus:ring-slate-500"/> <span>Activo</span></label> <label class="inline-flex items-center gap-2 text-sm text-slate-700"><input type="checkbox" class="rounded border-slate-300 text-slate-900 focus:ring-slate-500"/> <span>Staff (acceso a admin SPA)</span></label> <label class="inline-flex items-center gap-2 text-sm text-slate-700"><input type="checkbox" class="rounded border-slate-300 text-slate-900 focus:ring-slate-500"/> <span>Superuser</span></label></div></div> <div class="mt-5 flex items-center justify-end gap-2"><button class="rounded-lg px-3 py-2 ring-1 ring-slate-300 hover:bg-slate-50 text-sm">Cancelar</button> <button class="rounded-lg px-4 py-2 bg-slate-900 text-white hover:bg-black disabled:opacity-60 text-sm font-medium shadow-sm"> </button></div></div></div>'),Qt=f('<div class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50"><div> </div></div>'),Rt=f('<div class="min-h-screen bg-slate-50/80"><div class="mx-auto max-w-7xl px-4 py-6 lg:py-8"><div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between"><div class="space-y-2"><div class="inline-flex items-center gap-2 rounded-full bg-slate-900 text-slate-50 px-3 py-1 text-xs font-medium shadow-sm"><span class="inline-block h-1.5 w-1.5 rounded-full bg-emerald-400"></span> Panel admin · Usuarios</div> <div><h1 class="text-2xl sm:text-3xl font-semibold text-slate-900 tracking-tight">Gestión de usuarios</h1> <p class="text-slate-600 mt-1 text-sm sm:text-base">Administra accesos, roles y estado de las cuentas de la plataforma.</p></div></div> <div class="flex flex-col gap-3 sm:flex-row sm:items-center w-full sm:w-auto"><div class="flex flex-col gap-2 sm:flex-row sm:items-center w-full"><div class="flex items-center gap-2 w-full sm:w-auto"><div class="relative flex-1 sm:w-64"><span class="pointer-events-none absolute inset-y-0 left-3 flex items-center"><svg class="h-4 w-4 text-slate-400" viewBox="0 0 24 24" fill="none"><path d="M15.5 15.5L20 20" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"></path><circle cx="11" cy="11" r="5.5" stroke="currentColor" stroke-width="1.6"></circle></svg></span> <input class="w-full rounded-xl border border-slate-300 bg-white/80 px-9 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70 focus:border-amber-400 shadow-sm" placeholder="Buscar por usuario o email…"/></div> <button class="rounded-xl px-3 py-2 text-sm ring-1 ring-slate-300 hover:bg-slate-100 bg-white/80 shadow-sm whitespace-nowrap">Buscar</button></div> <div class="flex flex-wrap items-center gap-3 text-xs sm:text-sm text-slate-700"><label class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1"><input type="checkbox" class="rounded border-slate-300 text-slate-900 focus:ring-slate-500"/> <span>Solo activos</span></label> <label class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1"><input type="checkbox" class="rounded border-slate-300 text-slate-900 focus:ring-slate-500"/> <span>Solo staff</span></label></div></div> <button class="w-full sm:w-auto rounded-xl bg-slate-900 text-white px-4 py-2 text-sm font-medium shadow-md hover:bg-black transition-colors">+ Nuevo usuario</button></div></div> <div class="mt-6 rounded-2xl border border-slate-200 bg-white/90 shadow-sm backdrop-blur-sm"><!></div></div></div> <!> <!>',1);function na(dt,ct){Et(ct,!1);let je=c(!0),be=c(""),E=c([]),z=c(0),ge=c(null),Ue=c(null),Me=c(""),u=c(1);const te=12;let Ne=c(!1),Pe=c(!1),ae=c(!1),C=c(null),B=c(""),L=c(""),V=c(!0),Z=c(!1),q=c(!1),D=c(""),F=c(!1),_e=c(""),We=c("ok"),Xe=null;function se(s,o="ok"){r(_e,s),r(We,o),clearTimeout(Xe),Xe=setTimeout(()=>r(_e,""),3e3)}St(A);async function A(){r(je,!0),r(be,"");try{const s=await Mt({search:e(Me).trim()||void 0,page:e(u),page_size:te,only_active:e(Ne)||void 0,only_staff:e(Pe)||void 0});if(Array.isArray(s))r(E,s),r(z,s.length),r(ge,r(Ue,null));else{const o=s;r(E,o.results),r(z,o.count),r(ge,o.next),r(Ue,o.previous)}}catch(s){r(be,String(s?.message??s))}finally{r(je,!1)}}function vt(){r(C,null),r(B,""),r(L,""),r(V,!0),r(Z,!1),r(q,!1),r(D,""),r(ae,!0)}function Ye(s){r(C,s),r(B,s.username),r(L,s.email),r(V,!!s.is_active),r(Z,!!s.is_staff),r(q,!!s.is_superuser),r(D,""),r(ae,!0)}function he(){e(F)||r(ae,!1)}async function pt(){r(F,!0);try{if(!e(B).trim())throw new Error("El nombre de usuario es obligatorio");if(!e(L).trim())throw new Error("El email es obligatorio");if(e(C)){const s={username:e(B).trim(),email:e(L).trim(),is_active:e(V),is_staff:e(Z),is_superuser:e(q)};e(D).trim()&&(s.password=e(D).trim()),await Nt(e(C).id,s),se("Usuario actualizado.")}else await Pt({username:e(B).trim(),email:e(L).trim(),is_active:e(V),is_staff:e(Z),is_superuser:e(q),password:e(D).trim()||void 0}),se("Usuario creado.");r(ae,!1),await A()}catch(s){se(String(s?.message??s),"err")}finally{r(F,!1)}}async function $e(s){if(confirm(`¿Eliminar usuario "${s.username}"? Esta acción no se puede deshacer.`))try{await Tt(s.id),se("Usuario eliminado."),e(E).length===1&&e(u)>1&&r(u,e(u)-1),await A()}catch(o){se(String(o?.message??o),"err")}}function ut(){e(u)>1&&(r(u,e(u)-1),A())}function xt(){(e(ge)||e(E).length===te&&e(z)>e(u)*te)&&(r(u,e(u)+1),A())}function mt(s){s.key==="Enter"&&(r(u,1),A())}function ye(s){if(!s)return"—";const o=new Date(s);return Number.isNaN(o.getTime())?String(s):o.toLocaleString("es-CL",{dateStyle:"short",timeStyle:"short"})}Ut();var et=Rt(),Te=xe(et),tt=a(Te),ze=a(tt),at=l(a(ze),2),Be=a(at),Le=a(Be),De=a(Le),Ge=l(a(De),2);U(Ge),t(De);var ft=l(De,2);t(Le);var st=l(Le,2),Ie=a(st),Ve=a(Ie);U(Ve),me(2),t(Ie);var rt=l(Ie,2),Ze=a(rt);U(Ze),me(2),t(rt),t(st),t(Be);var bt=l(Be,2);t(at),t(ze);var lt=l(ze,2),gt=a(lt);{var _t=s=>{var o=zt();v(s,o)},ht=s=>{var o=ot(),j=xe(o);{var H=w=>{var k=Bt(),J=a(k),K=a(J,!0);t(J),t(k),T(()=>p(K,e(be))),v(w,k)},re=w=>{var k=ot(),J=xe(k);{var K=M=>{var N=Lt();v(M,N)},qe=M=>{var N=Kt(),G=xe(N);nt(G,5,()=>e(E),x=>x.id,(x,i)=>{var g=It(),h=a(g),y=a(h),_=a(y),oe=a(_,!0);t(_);var d=l(_,2),ne=a(d,!0);t(d),t(y);var ke=l(y,2),P=a(ke),He=a(P,!0);t(P);var Se=l(P,2);{var Je=n=>{var b=Dt();v(n,b)};S(Se,n=>{e(i).is_staff&&n(Je)})}var de=l(Se,2);{var Ke=n=>{var b=Gt();v(n,b)};S(de,n=>{e(i).is_superuser&&n(Ke)})}t(ke),t(h);var ce=l(h,2),ve=a(ce),$=l(a(ve),2),Oe=a($,!0);t($),t(ve);var ee=l(ve,2),Ee=l(a(ee),2),Ce=a(Ee,!0);t(Ee),t(ee),t(ce);var pe=l(ce,2),ue=a(pe),Qe=l(ue,2);t(pe),t(g),T((n,b)=>{p(oe,e(i).username),p(ne,e(i).email),Re(P,1,`px-2 py-0.5 rounded-full font-medium
                               ${e(i).is_active?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100":"bg-slate-100 text-slate-600 ring-1 ring-slate-200"}`),p(He,e(i).is_active?"Activo":"Inactivo"),p(Oe,n),p(Ce,b)},[()=>ye(e(i).date_joined),()=>ye(e(i).last_login)]),m("click",ue,()=>Ye(e(i))),m("click",Qe,()=>$e(e(i))),v(x,g)}),t(G);var O=l(G,2),Q=a(O),le=l(a(Q));nt(le,5,()=>e(E),x=>x.id,(x,i)=>{var g=Ht(),h=a(g),y=a(h,!0);t(h);var _=l(h),oe=a(_,!0);t(_);var d=l(_),ne=a(d),ke=a(ne,!0);t(ne),t(d);var P=l(d),He=a(P);{var Se=n=>{var b=Vt();v(n,b)},Je=n=>{var b=Zt();v(n,b)};S(He,n=>{e(i).is_staff?n(Se):n(Je,!1)})}t(P);var de=l(P),Ke=a(de);{var ce=n=>{var b=qt();v(n,b)},ve=n=>{var b=Ft();v(n,b)};S(Ke,n=>{e(i).is_superuser?n(ce):n(ve,!1)})}t(de);var $=l(de),Oe=a($,!0);t($);var ee=l($),Ee=a(ee,!0);t(ee);var Ce=l(ee),pe=a(Ce),ue=a(pe),Qe=l(ue,2);t(pe),t(Ce),t(g),T((n,b)=>{p(y,e(i).username),p(oe,e(i).email),Re(ne,1,`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium
                                 ${e(i).is_active?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-100":"bg-slate-100 text-slate-600 ring-1 ring-slate-200"}`),p(ke,e(i).is_active?"Sí":"No"),p(Oe,n),p(Ee,b)},[()=>ye(e(i).date_joined),()=>ye(e(i).last_login)]),m("click",ue,()=>Ye(e(i))),m("click",Qe,()=>$e(e(i))),v(x,g)}),t(le),t(Q),t(O);var R=l(O,2),I=a(R),Fe=a(I);{var ie=x=>{var i=Jt(),g=l(xe(i)),h=a(g,!0);t(g);var y=l(g,2),_=a(y,!0);t(y),T(()=>{p(h,e(u)),p(_,e(z))}),v(x,i)},we=x=>{var i=At();T(()=>p(i,`${e(E).length??""} usuario(s)`)),v(x,i)};S(Fe,x=>{e(z)?x(ie):x(we,!1)})}t(I);var W=l(I,2),X=a(W),Y=l(X,2);t(W),t(R),T(()=>{X.disabled=e(u)<=1||!e(Ue)&&!e(z),Y.disabled=!(e(ge)||e(E).length===te&&e(z)>e(u)*te)}),m("click",X,ut),m("click",Y,xt),v(M,N)};S(J,M=>{e(E).length===0?M(K):M(qe,!1)},!0)}v(w,k)};S(j,w=>{e(be)?w(H):w(re,!1)},!0)}v(s,o)};S(gt,s=>{e(je)?s(_t):s(ht,!1)})}t(lt),t(tt),t(Te);var it=l(Te,2);{var yt=s=>{var o=Ot(),j=a(o),H=l(j,2),re=a(H),w=a(re),k=a(w),J=a(k,!0);t(k);var K=l(k,2),qe=a(K,!0);t(K),t(w);var M=l(w,2);t(re);var N=l(re,2),G=a(N),O=l(a(G),2);U(O),t(G);var Q=l(G,2),le=l(a(Q),2);U(le),t(Q);var R=l(Q,2),I=a(R),Fe=a(I);t(I);var ie=l(I,2);U(ie),t(R);var we=l(R,2),W=a(we),X=a(W);U(X),me(2),t(W);var Y=l(W,2),x=a(Y);U(x),me(2),t(Y);var i=l(Y,2),g=a(i);U(g),me(2),t(i),t(we),t(N);var h=l(N,2),y=a(h),_=l(y,2),oe=a(_,!0);t(_),t(h),t(H),t(o),T(()=>{p(J,e(C)?"Editar usuario":"Nuevo usuario"),p(qe,e(C)?"Actualiza la información y roles del usuario.":"Crea una nueva cuenta para la plataforma."),p(Fe,`Password ${e(C)?"(dejar vacío para no cambiar)":""}`),jt(ie,"placeholder",e(C)?"••••••":"Mínimo 8 caracteres"),y.disabled=e(F),_.disabled=e(F),p(oe,e(F)?"Guardando…":e(C)?"Guardar cambios":"Crear usuario")}),m("click",j,he),m("keydown",j,d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),he())}),m("click",M,he),Ae(O,()=>e(B),d=>r(B,d)),Ae(le,()=>e(L),d=>r(L,d)),Ae(ie,()=>e(D),d=>r(D,d)),fe(X,()=>e(V),d=>r(V,d)),fe(x,()=>e(Z),d=>r(Z,d)),fe(g,()=>e(q),d=>r(q,d)),m("click",y,he),m("click",_,pt),v(s,o)};S(it,s=>{e(ae)&&s(yt)})}var wt=l(it,2);{var kt=s=>{var o=Qt(),j=a(o),H=a(j,!0);t(j),t(o),T(()=>{Re(j,1,`rounded-xl px-4 py-2 text-sm shadow-lg
                ${e(We)==="ok"?"bg-emerald-600 text-white":"bg-rose-600 text-white"}`),p(H,e(_e))}),v(s,o)};S(wt,s=>{e(_e)&&s(kt)})}Ae(Ge,()=>e(Me),s=>r(Me,s)),m("keydown",Ge,mt),m("click",ft,()=>{r(u,1),A()}),fe(Ve,()=>e(Ne),s=>r(Ne,s)),m("change",Ve,()=>{r(u,1),A()}),fe(Ze,()=>e(Pe),s=>r(Pe,s)),m("change",Ze,()=>{r(u,1),A()}),m("click",bt,vt),v(dt,et),Ct()}export{na as component};
