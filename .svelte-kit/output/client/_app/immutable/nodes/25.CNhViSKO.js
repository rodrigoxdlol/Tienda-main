import"../chunks/DsnmJJEf.js";import"../chunks/luk3gl1z.js";import{p as M,w as Q,a as Y,b as p,c as Z,f as v,s as n,d as c,g as e,m as f,r as l,t as q,e as t}from"../chunks/CwLoShKX.js";import{s as z,e as ee}from"../chunks/D8bngpjW.js";import{i as E}from"../chunks/WMMc_YU6.js";import{e as te,i as ae}from"../chunks/ThBeqclG.js";import{r as S}from"../chunks/CkmYFb5S.js";import{b as C}from"../chunks/DGOQ8hUW.js";import{p as se}from"../chunks/CdEA5IGF.js";import{i as re}from"../chunks/Ccxz8Bhd.js";import{s as oe,a as ie}from"../chunks/DH8C1yjn.js";import{u as ne,a as le}from"../chunks/C-KkEP16.js";import{a as ce,t as de}from"../chunks/wZ8Uf4_x.js";var me=v('<section class="max-w-lg mx-auto bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mt-4"><h1 class="text-xl font-semibold text-slate-900 mb-2">Inicia sesión para cambiar tu contraseña</h1> <p class="text-sm text-slate-600 mb-4">Esta sección está disponible solo para clientes registrados.</p> <a href="/login" class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium bg-amber-600 text-white hover:bg-amber-700">Ir a iniciar sesión</a></section>'),ue=v("<p> </p>"),pe=v('<div class="rounded-xl border border-rose-100 bg-rose-50 px-4 py-3 text-xs text-rose-700 space-y-1"></div>'),fe=v('<section class="max-w-xl mx-auto mt-4"><header class="mb-6"><h1 class="text-2xl font-semibold text-slate-900 tracking-tight">Cambiar contraseña</h1> <p class="mt-1 text-sm text-slate-600">Actualiza la contraseña de tu cuenta para mantener tu información segura.</p></header> <form class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-4"><!> <div class="space-y-1"><label for="old" class="block text-sm font-medium text-slate-700">Contraseña actual</label> <input id="old" type="password" autocomplete="current-password" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500" required/></div> <div class="space-y-1"><label for="new1" class="block text-sm font-medium text-slate-700">Nueva contraseña</label> <input id="new1" type="password" autocomplete="new-password" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500" required/></div> <div class="space-y-1"><label for="new2" class="block text-sm font-medium text-slate-700">Repetir nueva contraseña</label> <input id="new2" type="password" autocomplete="new-password" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500" required/></div> <div class="flex flex-col gap-2 text-xs text-slate-500"><p class="font-medium text-slate-600">Recomendaciones:</p> <ul class="list-disc list-inside space-y-0.5"><li>Usa al menos 8 caracteres.</li> <li>Combina letras mayúsculas, minúsculas, números y símbolos.</li> <li>No reutilices contraseñas de otros sitios.</li></ul></div> <div class="pt-2 flex justify-end gap-2"><a href="/mi-cuenta/perfil" class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium ring-1 ring-slate-300 text-slate-700 hover:bg-slate-50">Volver a mi perfil</a> <button type="submit" class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium bg-amber-600 text-white hover:bg-amber-700 disabled:opacity-60"> </button></div></form></section>');function Ne(I,R){M(R,!1);const[T,D]=oe(),G=()=>ie(ne,"$user",T),L="https://tienda-backend-rodrigo.azurewebsites.net".replace(/\/+$/,"");function O(){return typeof document>"u"?"":document.cookie.split("; ").find(r=>r.startsWith("csrftoken="))?.split("=")[1]??""}let u=f(""),d=f(""),m=f(""),b=f(!1),a=f([]);async function V(r){if(r.preventDefault(),t(a,[]),!e(u)||!e(d)||!e(m)){t(a,["Completa todos los campos."]);return}if(e(d)!==e(m)){t(a,["Las contraseñas nuevas no coinciden."]);return}t(b,!0);try{const s=await fetch(`${L}/api/auth/change-password/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":O()},body:JSON.stringify({old_password:e(u),new_password1:e(d),new_password2:e(m)})});if(!s.ok){try{const o=await s.json();Array.isArray(o.detail)?t(a,o.detail.map(x=>String(x))):o.detail?t(a,[String(o.detail)]):t(a,["No se pudo cambiar la contraseña."])}catch{const o=await s.text();t(a,[o||"No se pudo cambiar la contraseña."])}return}ce("Contraseña actualizada correctamente. Vuelve a iniciar sesión."),t(u,""),t(d,""),t(m,""),t(a,[]),await le(),window.location.href="/login"}catch(s){t(a,[String(s?.message??s)||"Error al conectar con el servidor."]),de(e(a)[0])}finally{t(b,!1)}}re();var j=Q(),F=Y(j);{var J=r=>{var s=me();p(r,s)},U=r=>{var s=fe(),o=n(c(s),2),x=c(o);{var W=i=>{var _=pe();te(_,5,()=>e(a),ae,(B,H)=>{var k=ue(),K=c(k,!0);l(k),q(()=>z(K,e(H))),p(B,k)}),l(_),p(i,_)};E(x,i=>{e(a).length&&i(W)})}var w=n(x,2),$=n(c(w),2);S($),l(w);var g=n(w,2),N=n(c(g),2);S(N),l(g);var h=n(g,2),P=n(c(h),2);S(P),l(h);var A=n(h,4),y=n(c(A),2),X=c(y,!0);l(y),l(A),l(o),l(s),q(()=>{y.disabled=e(b),z(X,e(b)?"Guardando…":"Guardar contraseña")}),C($,()=>e(u),i=>t(u,i)),C(N,()=>e(d),i=>t(d,i)),C(P,()=>e(m),i=>t(m,i)),ee("submit",o,se(V)),p(r,s)};E(F,r=>{G()?.authenticated?r(U,!1):r(J)})}p(I,j),Z(),D()}export{Ne as component};
