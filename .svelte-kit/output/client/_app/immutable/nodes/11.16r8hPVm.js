import"../chunks/DsnmJJEf.js";import"../chunks/luk3gl1z.js";import{o as ft}from"../chunks/_gNL4IXV.js";import{p as _t,o as I,q as gt,f as h,t as R,d as a,s as r,g as e,b as p,c as ht,m as u,e as o,x as yt,r as s,n as ke,u as d,w as ee,a as U,y as wt,h as kt,v as Ct}from"../chunks/CwLoShKX.js";import{s as v,e as Z}from"../chunks/D8bngpjW.js";import{i as C}from"../chunks/WMMc_YU6.js";import{e as Ce,i as je}from"../chunks/ThBeqclG.js";import{r as jt}from"../chunks/CkmYFb5S.js";import{s as Me}from"../chunks/DIJ89BUl.js";import{b as Oe}from"../chunks/DGOQ8hUW.js";import{b as Mt}from"../chunks/COJT2EDT.js";import{i as Pt}from"../chunks/Ccxz8Bhd.js";import{a as Et,b as Lt}from"../chunks/BtBNgcIe.js";var Rt=h('<div class="rounded-lg bg-red-50 border border-red-200 text-red-800 text-sm px-3 py-2"> </div>'),Tt=h('<span class="text-xs text-slate-400">Cargando…</span>'),At=h('<span class="text-[11px] text-slate-400"> </span>'),It=h('<tr class="border-b border-slate-100"><td class="px-3 py-3" colspan="6"><div class="animate-pulse h-3 rounded bg-slate-100 max-w-[80%] mb-2"></div> <div class="animate-pulse h-3 rounded bg-slate-100 max-w-[40%]"></div></td></tr>'),St=h('<tr><td colspan="6" class="px-3 py-6 text-center text-xs text-slate-400">No se encontraron mensajes con el filtro actual.</td></tr>'),qt=h('<div class="text-[11px] text-slate-400"> </div>'),Gt=h('<tr class="border-b last:border-b-0 border-slate-100 hover:bg-slate-50/70 cursor-pointer"><td class="px-3 py-2 whitespace-nowrap"><div class="font-medium text-slate-800"> </div> <!></td><td class="px-3 py-2 whitespace-nowrap text-slate-600"> </td><td class="px-3 py-2"><div class="max-w-[180px] truncate"> </div> <div class="text-[11px] text-slate-400 max-w-[220px] truncate"> </div></td><td class="px-3 py-2 whitespace-nowrap text-slate-500"> </td><td class="px-3 py-2"><span> </span></td><td class="px-3 py-2 text-right"><button type="button" class="text-[11px] font-medium text-amber-700 hover:text-amber-900 underline">Ver</button></td></tr>'),Nt=h('<button type="button"></button>'),Bt=h('<span class="px-1 text-slate-400">…</span>'),Dt=h(`<div class="border-t border-slate-100 px-4 py-2 flex items-center justify-between text-[11px]"><span class="text-slate-400"> </span> <div class="flex items-center gap-1"><button type="button" class="px-2 py-1 rounded-full border border-slate-200 text-slate-600 text-[11px]
                       disabled:opacity-40 disabled:cursor-not-allowed bg-white hover:bg-slate-50">←</button> <!> <button type="button" class="px-2 py-1 rounded-full border border-slate-200 text-slate-600 text-[11px]
                       disabled:opacity-40 disabled:cursor-not-allowed bg-white hover:bg-slate-50">→</button></div></div>`),$t=h('<p class="text-[11px] text-slate-400"> </p>'),zt=kt('<svg class="animate-spin" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" opacity=".25"></circle><path d="M22 12a10 10 0 0 1-10 10" stroke="currentColor" stroke-width="4"></path></svg> Guardando…',1),Vt=h(`<header class="flex items-start justify-between gap-2 mb-3"><div><h2 class="text-sm font-semibold text-slate-900"> </h2> <p class="text-xs text-slate-500"> </p></div> <span> </span></header> <div class="mb-4"><p class="text-[11px] uppercase font-semibold text-slate-400 mb-1">Mensaje</p> <div class="rounded-lg bg-slate-50 border border-slate-100 px-3 py-2 text-sm text-slate-700 whitespace-pre-line"> </div> <p class="mt-1 text-[11px] text-slate-400"> </p></div> <div class="space-y-2"><label class="text-xs font-medium text-slate-700">Respuesta al cliente</label> <textarea rows="6" class="w-full rounded-lg border border-slate-300 px-3 py-2 text-sm
                     focus:outline-none focus:ring-2 focus:ring-amber-500/70 focus:border-amber-500" placeholder="Escribe aquí la respuesta que se enviará al correo del cliente…"></textarea> <!></div> <div class="mt-3 flex items-center justify-between gap-3"><button type="button" class="text-xs text-slate-500 hover:text-slate-700">← Volver a la lista</button> <button type="button" class="inline-flex items-center gap-2 rounded-full bg-amber-600 px-4 py-1.5 text-xs md:text-sm font-medium
                     text-white shadow-sm hover:bg-amber-700 active:bg-amber-800
                     disabled:opacity-60 disabled:cursor-not-allowed
                     transition transform active:scale-[.98]"><!></button></div>`,1),Ft=h('<div class="h-full flex flex-col items-center justify-center text-center text-slate-400 text-sm"><p class="mb-1 font-medium text-slate-500">Selecciona un mensaje</p> <p class="text-xs max-w-xs">Haz clic en un reclamo u opinión de la tabla para ver el detalle y responderle al cliente.</p></div>'),Ht=h(`<main class="p-4 md:p-6"><section class="max-w-6xl mx-auto space-y-4"><header class="space-y-3"><div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3"><div><h1 class="text-xl md:text-2xl font-semibold text-slate-900">Reclamos y opiniones</h1> <p class="text-sm text-slate-500">Gestiona los mensajes enviados desde el formulario de contacto y responde a tus clientes.</p></div> <div class="flex flex-col sm:flex-row gap-2 sm:items-center"><div class="flex items-center gap-2"><label class="text-xs font-medium text-slate-500">Estado:</label> <select class="rounded-full border border-slate-300 text-xs px-3 py-1.5
                     focus:outline-none focus:ring-2 focus:ring-amber-500/70 focus:border-amber-500 bg-white"><option>Pendientes</option><option>Respondidos</option><option>Cerrados</option><option>Todos</option></select></div> <div class="relative"><input type="search" placeholder="Buscar por nombre, email, asunto o mensaje…" class="w-full sm:w-64 rounded-full border border-slate-300 pl-8 pr-3 py-1.5 text-xs
                     focus:outline-none focus:ring-2 focus:ring-amber-500/70 focus:border-amber-500"/> <span class="absolute left-2 top-1.5 text-slate-400"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="2"></circle><path d="m16 16 3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg></span></div></div></div> <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-xs"><div class="rounded-xl border border-slate-200 bg-white px-3 py-2.5"><p class="text-[11px] text-slate-500">Pendientes</p> <p class="mt-1 text-lg font-semibold text-slate-900"> </p></div> <div class="rounded-xl border border-slate-200 bg-white px-3 py-2.5"><p class="text-[11px] text-slate-500">Respondidos</p> <p class="mt-1 text-lg font-semibold text-slate-900"> </p></div> <div class="rounded-xl border border-slate-200 bg-white px-3 py-2.5"><p class="text-[11px] text-slate-500">Cerrados</p> <p class="mt-1 text-lg font-semibold text-slate-900"> </p></div> <div class="rounded-xl border border-slate-200 bg-white px-3 py-2.5"><p class="text-[11px] text-slate-500">Total</p> <p class="mt-1 text-lg font-semibold text-slate-900"> </p></div></div></header> <!> <div class="grid lg:grid-cols-5 gap-4 items-start"><div class="lg:col-span-3 bg-white rounded-2xl shadow-sm border border-slate-100 flex flex-col"><div class="px-4 py-3 border-b border-slate-100 flex items-center justify-between"><h2 class="text-sm font-semibold text-slate-800">Mensajes</h2> <!></div> <div class="overflow-x-auto max-h-[520px]"><table class="min-w-full text-xs md:text-sm"><thead class="bg-slate-50 border-b border-slate-100 sticky top-0 z-10"><tr class="text-left text-[11px] md:text-xs text-slate-500 uppercase tracking-wide"><th class="px-3 py-2">Nombre</th><th class="px-3 py-2">Email</th><th class="px-3 py-2">Asunto</th><th class="px-3 py-2">Fecha</th><th class="px-3 py-2">Estado</th><th class="px-3 py-2"></th></tr></thead><tbody><!></tbody></table></div> <!></div> <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-100 p-4 md:p-5"><!></div></div></section></main>`);function ra(Qe,We){_t(We,!1);const Pe=u(),Ee=u(),Le=u(),Re=u(),T=u(),j=u(),ae=u(),$=u();let J=u(!0),te=u(!1),z=u(""),m=u([]),n=u(null),S=u(""),M=u("pending"),V=u("");const se=10;let f=u(1);async function Xe(){o(J,!0),o(z,"");try{const t=await Et();o(m,[...t].sort((l,c)=>new Date(c.created_at).getTime()-new Date(l.created_at).getTime()))}catch(t){console.error(t),o(z,"No se pudieron cargar los reclamos.")}finally{o(J,!1)}}ft(Xe);function Ye(t){o(n,t),o(S,t.admin_reply??"")}function re(t){return t?t.replace("T"," ").slice(0,16):"-"}function Te(t){return t==="pending"?"Pendiente":t==="answered"?"Respondido":"Cerrado"}const Ae=t=>t==="pending"?"bg-amber-100 text-amber-800 ring-amber-200":t==="answered"?"bg-green-100 text-green-800 ring-green-200":"bg-slate-100 text-slate-700 ring-slate-200";function le(t){t<1||t>e(j)||o(f,t)}async function et(){if(e(n)){o(te,!0),o(z,"");try{const t=e(S).trim()&&e(n).status==="pending"?"answered":e(n).status,l=await Lt(e(n).id,{admin_reply:e(S).trim(),status:t}),c=e(m).findIndex(k=>k.id===l.id);c!==-1&&o(m,[...e(m).slice(0,c),l,...e(m).slice(c+1)]),e(M)!=="all"&&l.status!==e(M)?(o(n,null),o(S,"")):o(n,l)}catch(t){console.error(t),o(z,"No se pudo guardar la respuesta.")}finally{o(te,!1)}}}I(()=>e(m),()=>{o(Pe,e(m).filter(t=>t.status==="pending").length)}),I(()=>e(m),()=>{o(Ee,e(m).filter(t=>t.status==="answered").length)}),I(()=>e(m),()=>{o(Le,e(m).filter(t=>t.status==="closed").length)}),I(()=>e(m),()=>{o(Re,e(m).length)}),I(()=>(e(m),e(M),e(V)),()=>{o(T,e(m).filter(t=>{if(e(M)!=="all"&&t.status!==e(M))return!1;const l=e(V).trim().toLowerCase();return l?t.name.toLowerCase().includes(l)||t.email.toLowerCase().includes(l)||(t.subject||"").toLowerCase().includes(l)||(t.message||"").toLowerCase().includes(l):!0}))}),I(()=>e(T),()=>{o(j,Math.max(1,Math.ceil(e(T).length/se)))}),I(()=>(e(M),e(V),e(T)),()=>{o(ae,`${e(M)}-${e(V)}-${e(T).length}`)}),I(()=>e(ae),()=>{e(ae)&&o(f,1)}),I(()=>(e(T),e(f)),()=>{o($,e(T).slice((e(f)-1)*se,e(f)*se))}),gt(),Pt();var oe=Ht(),Ie=a(oe),ne=a(Ie),de=a(ne),Se=r(a(de),2),ie=a(Se),ce=r(a(ie),2);R(()=>{e(M),yt(()=>{})});var pe=a(ce);pe.value=pe.__value="pending";var ve=r(pe);ve.value=ve.__value="answered";var xe=r(ve);xe.value=xe.__value="closed";var qe=r(xe);qe.value=qe.__value="all",s(ce),s(ie);var Ge=r(ie,2),Ne=a(Ge);jt(Ne),ke(2),s(Ge),s(Se),s(de);var Be=r(de,2),ue=a(Be),De=r(a(ue),2),tt=a(De,!0);s(De),s(ue);var be=r(ue,2),$e=r(a(be),2),at=a($e,!0);s($e),s(be);var me=r(be,2),ze=r(a(me),2),st=a(ze,!0);s(ze),s(me);var Ve=r(me,2),Fe=r(a(Ve),2),rt=a(Fe,!0);s(Fe),s(Ve),s(Be),s(ne);var He=r(ne,2);{var lt=t=>{var l=Rt(),c=a(l,!0);s(l),R(()=>v(c,e(z))),p(t,l)};C(He,t=>{e(z)&&t(lt)})}var Ke=r(He,2),fe=a(Ke),_e=a(fe),ot=r(a(_e),2);{var nt=t=>{var l=Tt();p(t,l)},dt=t=>{var l=At(),c=a(l);s(l),R(()=>v(c,`Mostrando ${e($),d(()=>e($).length)??""} de ${e(T),d(()=>e(T).length)??""}`)),p(t,l)};C(ot,t=>{e(J)?t(nt):t(dt,!1)})}s(_e);var ge=r(_e,2),Ue=a(ge),Ze=r(a(Ue)),it=a(Ze);{var ct=t=>{var l=ee(),c=U(l);Ce(c,0,()=>Array(5),je,(k,A)=>{var g=It();p(k,g)}),p(t,l)},pt=t=>{var l=ee(),c=U(l);{var k=g=>{var P=St();p(g,P)},A=g=>{var P=ee(),F=U(P);Ce(F,1,()=>e($),je,(q,i)=>{var b=Gt(),E=a(b),G=a(E),H=a(G,!0);s(G);var O=r(G,2);{var w=D=>{var Y=qt(),we=a(Y,!0);s(Y),R(()=>v(we,(e(i),d(()=>e(i).phone)))),p(D,Y)};C(O,D=>{e(i),d(()=>e(i).phone)&&D(w)})}s(E);var _=r(E),Q=a(_,!0);s(_);var N=r(_),L=a(N),K=a(L,!0);s(L);var B=r(L,2),he=a(B,!0);s(B),s(N);var W=r(N),ye=a(W,!0);s(W);var x=r(W),y=a(x),X=a(y,!0);s(y),s(x),ke(),s(b),R((D,Y,we)=>{v(H,(e(i),d(()=>e(i).name))),v(Q,(e(i),d(()=>e(i).email))),v(K,(e(i),d(()=>e(i).subject||"Sin asunto"))),v(he,(e(i),d(()=>e(i).message))),v(ye,D),Me(y,1,Y),v(X,we)},[()=>(e(i),d(()=>re(e(i).created_at))),()=>(e(i),d(()=>`inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-medium ring-1 ${Ae(e(i).status)}`)),()=>(e(i),d(()=>Te(e(i).status)))]),Z("click",b,()=>Ye(e(i))),p(q,b)}),p(g,P)};C(c,g=>{e($),d(()=>e($).length===0)?g(k):g(A,!1)},!0)}p(t,l)};C(it,t=>{e(J)?t(ct):t(pt,!1)})}s(Ze),s(Ue),s(ge);var vt=r(ge,2);{var xt=t=>{var l=Dt(),c=a(l),k=a(c);s(c);var A=r(c,2),g=a(A),P=r(g,2);Ce(P,1,()=>(e(j),d(()=>Array(e(j)))),je,(q,i,b)=>{var E=ee(),G=U(E);{var H=w=>{var _=Nt();_.textContent=b+1,R(()=>Me(_,1,`px-2 py-1 rounded-full border text-[11px] ${e(f)===b+1?"bg-amber-600 text-white border-amber-600":"border-slate-200 text-slate-600 bg-white hover:bg-slate-50"}`)),Z("click",_,()=>le(b+1)),p(w,_)},O=w=>{var _=ee(),Q=U(_);{var N=L=>{var K=Bt();p(L,K)};C(Q,L=>{e(f),d(()=>Math.abs(b+1-e(f))===2)&&L(N)},!0)}p(w,_)};C(G,w=>{e(j),e(f),d(()=>e(j)<=6||b+1===1||b+1===e(j)||Math.abs(b+1-e(f))<=1)?w(H):w(O,!1)})}p(q,E)});var F=r(P,2);s(A),s(l),R(()=>{v(k,`Página ${e(f)??""} de ${e(j)??""}`),g.disabled=e(f)===1,F.disabled=e(f)===e(j)}),Z("click",g,()=>le(e(f)-1)),Z("click",F,()=>le(e(f)+1)),p(t,l)};C(vt,t=>{!e(J)&&e(j)>1&&t(xt)})}s(fe);var Je=r(fe,2),ut=a(Je);{var bt=t=>{var l=Vt(),c=U(l),k=a(c),A=a(k),g=a(A,!0);s(A);var P=r(A,2),F=a(P);s(P),s(k);var q=r(k,2),i=a(q,!0);s(q),s(c);var b=r(c,2),E=r(a(b),2),G=a(E,!0);s(E);var H=r(E,2),O=a(H);s(H),s(b);var w=r(b,2),_=r(a(w),2);wt(_);var Q=r(_,2);{var N=x=>{var y=$t(),X=a(y);s(y),R(D=>v(X,`Última respuesta enviada el ${D??""}`),[()=>(e(n),d(()=>re(e(n).replied_at)))]),p(x,y)};C(Q,x=>{e(n),d(()=>e(n).replied_at)&&x(N)})}s(w);var L=r(w,2),K=a(L),B=r(K,2),he=a(B);{var W=x=>{var y=zt();ke(),p(x,y)},ye=x=>{var y=Ct("Guardar respuesta");p(x,y)};C(he,x=>{e(te)?x(W):x(ye,!1)})}s(B),s(L),R((x,y,X)=>{v(g,(e(n),d(()=>e(n).subject||"Sin asunto"))),v(F,`${e(n),d(()=>e(n).name)??""} · ${e(n),d(()=>e(n).email)??""}`),Me(q,1,x),v(i,y),v(G,(e(n),d(()=>e(n).message))),v(O,`Enviado el ${X??""}`),B.disabled=e(te)},[()=>(e(n),d(()=>`inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-medium ring-1 ${Ae(e(n).status)}`)),()=>(e(n),d(()=>Te(e(n).status))),()=>(e(n),d(()=>re(e(n).created_at)))]),Oe(_,()=>e(S),x=>o(S,x)),Z("click",K,()=>{o(n,null),o(S,"")}),Z("click",B,et),p(t,l)},mt=t=>{var l=Ft();p(t,l)};C(ut,t=>{e(n)?t(bt):t(mt,!1)})}s(Je),s(Ke),s(Ie),s(oe),R(()=>{v(tt,e(Pe)),v(at,e(Ee)),v(st,e(Le)),v(rt,e(Re))}),Mt(ce,()=>e(M),t=>o(M,t)),Oe(Ne,()=>e(V),t=>o(V,t)),p(Qe,oe),ht()}export{ra as component};
