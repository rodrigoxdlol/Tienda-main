import"../chunks/DsnmJJEf.js";import"../chunks/luk3gl1z.js";import{p as Y,o as j,q as Z,f,b as m,c as ee,s as l,d as c,e as t,m as d,u as A,r as i,g as e,t as T}from"../chunks/CwLoShKX.js";import{s as q,e as te}from"../chunks/D8bngpjW.js";import{i as D}from"../chunks/WMMc_YU6.js";import{e as ae,i as se}from"../chunks/ThBeqclG.js";import{r as R}from"../chunks/CkmYFb5S.js";import{b as G}from"../chunks/DGOQ8hUW.js";import{p as re}from"../chunks/CdEA5IGF.js";import{i as oe}from"../chunks/Ccxz8Bhd.js";import{s as ie,a as ne}from"../chunks/DH8C1yjn.js";import{p as le}from"../chunks/DmIQJ0OO.js";import{g as ce}from"../chunks/5pKeZvy2.js";import{t as I,a as de}from"../chunks/wZ8Uf4_x.js";var ue=f('<div class="bg-rose-50 border border-rose-100 text-rose-700 rounded-2xl px-4 py-3 text-sm">El enlace para restablecer la contraseña no es válido o le faltan datos. <br/> Vuelve a solicitar uno desde la página de <a href="/recuperar-clave" class="underline hover:text-rose-800">recuperación de contraseña</a>.</div>'),pe=f("<p> </p>"),me=f('<div class="rounded-xl border border-rose-100 bg-rose-50 px-4 py-3 text-xs text-rose-700 space-y-1"></div>'),fe=f('<form class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-4"><!> <div class="space-y-1"><label for="new1" class="block text-sm font-medium text-slate-700">Nueva contraseña</label> <input id="new1" type="password" autocomplete="new-password" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500" required/></div> <div class="space-y-1"><label for="new2" class="block text-sm font-medium text-slate-700">Repetir nueva contraseña</label> <input id="new2" type="password" autocomplete="new-password" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500" required/></div> <div class="flex flex-col gap-2 text-xs text-slate-500"><p class="font-medium text-slate-600">Recomendaciones:</p> <ul class="list-disc list-inside space-y-0.5"><li>Usa al menos 8 caracteres.</li> <li>Combina letras, números y símbolos.</li> <li>No reutilices contraseñas de otros sitios.</li></ul></div> <div class="pt-2 flex justify-between items-center"><a href="/login" class="text-xs text-slate-500 hover:text-slate-700 underline-offset-2 hover:underline">Volver al inicio de sesión</a> <button type="submit" class="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium bg-amber-600 text-white hover:bg-amber-700 disabled:opacity-60"> </button></div></form>'),ve=f('<section class="max-w-xl mx-auto mt-6"><header class="mb-6 text-center"><h1 class="text-2xl font-semibold text-slate-900 tracking-tight">Definir nueva contraseña</h1> <p class="mt-1 text-sm text-slate-600">Elige una nueva contraseña para tu cuenta.</p></header> <!></section>');function je(O,V){Y(V,!1);const[z,F]=ie(),v=()=>ne(le,"$page",z),x=d(),g=d(),J="https://tienda-backend-rodrigo.azurewebsites.net".replace(/\/+$/,"");function L(){return typeof document>"u"?"":document.cookie.split("; ").find(o=>o.startsWith("csrftoken="))?.split("=")[1]??""}let u=d(""),p=d(""),b=d(!1),a=d([]);const P=()=>!e(x)||!e(g);async function U(o){if(o.preventDefault(),t(a,[]),P()){t(a,["El enlace no es válido o está incompleto."]);return}if(!e(u)||!e(p)){t(a,["Completa ambos campos de contraseña."]);return}if(e(u)!==e(p)){t(a,["Las contraseñas no coinciden."]);return}t(b,!0);try{const s=await fetch(`${J}/api/auth/password-reset/confirm/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":L()},body:JSON.stringify({uid:e(x),token:e(g),new_password1:e(u),new_password2:e(p)})});if(!s.ok){try{const r=await s.json();Array.isArray(r.detail)?t(a,r.detail.map(w=>String(w))):r.detail?t(a,[String(r.detail)]):t(a,["No se pudo establecer la nueva contraseña."])}catch{const r=await s.text();t(a,[r||"No se pudo establecer la nueva contraseña."])}I(e(a)[0]||"Error al restablecer la contraseña.");return}de("Contraseña restablecida. Ahora puedes iniciar sesión."),setTimeout(()=>ce("/login"),1200)}catch(s){const r=String(s?.message??s)||"Error al conectar con el servidor.";t(a,[r]),I(r)}finally{t(b,!1)}}j(()=>v(),()=>{t(x,v().url.searchParams.get("uid")??"")}),j(()=>v(),()=>{t(g,v().url.searchParams.get("token")??"")}),Z(),oe();var h=ve(),W=l(c(h),2);{var X=o=>{var s=ue();m(o,s)},B=o=>{var s=fe(),r=c(s);{var w=n=>{var S=me();ae(S,5,()=>e(a),se,(K,M)=>{var E=pe(),Q=c(E,!0);i(E),T(()=>q(Q,e(M))),m(K,E)}),i(S),m(n,S)};D(r,n=>{e(a),A(()=>e(a).length)&&n(w)})}var _=l(r,2),$=l(c(_),2);R($),i(_);var y=l(_,2),C=l(c(y),2);R(C),i(y);var N=l(y,4),k=l(c(N),2),H=c(k,!0);i(k),i(N),i(s),T(()=>{k.disabled=e(b),q(H,e(b)?"Guardando…":"Guardar nueva contraseña")}),G($,()=>e(u),n=>t(u,n)),G(C,()=>e(p),n=>t(p,n)),te("submit",s,re(U)),m(o,s)};D(W,o=>{A(P)?o(X):o(B,!1)})}i(h),m(O,h),ee(),F()}export{je as component};
