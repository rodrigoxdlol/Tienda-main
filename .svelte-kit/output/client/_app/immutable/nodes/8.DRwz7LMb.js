import"../chunks/DsnmJJEf.js";import"../chunks/luk3gl1z.js";import{o as We}from"../chunks/_gNL4IXV.js";import{p as Xe,f as p,t as w,g as e,b as v,c as Ye,s as o,d as r,e as n,m as u,r as s,y as Ze,n as Y,h as $e,v as I,w as et,a as tt}from"../chunks/CwLoShKX.js";import{e as E,s as A}from"../chunks/D8bngpjW.js";import{i as x}from"../chunks/WMMc_YU6.js";import{e as xe,i as be}from"../chunks/ThBeqclG.js";import{r as ge,s as Z}from"../chunks/CkmYFb5S.js";import{s as at}from"../chunks/DIJ89BUl.js";import{b as $}from"../chunks/DGOQ8hUW.js";import{p as st}from"../chunks/CdEA5IGF.js";import{i as rt}from"../chunks/Ccxz8Bhd.js";import{k as it,l as lt,m as ot,n as nt}from"../chunks/Q6rjOpry.js";import{t as R,a as ee}from"../chunks/wZ8Uf4_x.js";var dt=p('<div class="mt-2 rounded-2xl overflow-hidden border border-slate-200 bg-slate-50"><img alt="Vista previa" class="w-full h-48 object-cover"/></div>'),ct=$e('<svg class="h-4 w-4 animate-spin" viewBox="0 0 24 24" fill="none"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 0 1 8-8v3a5 5 0 0 0-5 5H4z"></path></svg> Guardando…',1),vt=p('<div class="h-48 rounded-2xl bg-slate-100 animate-pulse"></div>'),mt=p('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>'),pt=p('<p class="text-sm text-slate-600">Aún no hay noticias. Agrega la primera usando el formulario de arriba.</p>'),ft=p('<h3 class="text-sm font-semibold text-slate-900 truncate"> </h3>'),ut=p('<p class="line-clamp-2"> </p>'),xt=p('<span class="inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] text-emerald-700">Activa</span>'),bt=p('<span class="inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[11px] text-slate-600">Oculta</span>'),gt=p('<article class="relative rounded-2xl overflow-hidden border border-slate-200 bg-slate-50 shadow-sm"><div class="aspect-[4/3] bg-slate-100"><img class="h-full w-full object-cover" loading="lazy"/></div> <div class="p-3 space-y-1 text-xs text-slate-700"><!> <!> <p class="text-[11px] text-slate-500"> </p> <div class="mt-1 flex items-center justify-between text-[11px]"><div>Estado: <!></div> <button type="button"><!></button></div></div> <button type="button" class="absolute top-2 right-2 rounded-full bg-black/60 text-white p-1.5 text-[11px] hover:bg-black/80"><!></button></article>'),_t=p('<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>'),ht=p('<section class="mx-auto max-w-6xl px-4 py-6 space-y-6"><header class="flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between"><div><h1 class="text-2xl sm:text-3xl font-semibold text-slate-900 tracking-tight">Noticias (imágenes)</h1> <p class="text-sm text-slate-600">Sube imágenes de novedades, rifas y nuevos productos que se mostrarán en la sección <strong>/noticias</strong> del sitio público.</p></div> <div class="text-xs text-slate-500"> </div></header> <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm space-y-4"><h2 class="text-sm font-semibold text-slate-800">Agregar nueva noticia</h2> <form class="grid gap-4 md:grid-cols-2"><div class="space-y-3"><div><label class="block text-xs font-medium text-slate-700 mb-1">Título (opcional)</label> <input class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70" placeholder="Ej: Rifa cocina a leña invierno"/></div> <div><label class="block text-xs font-medium text-slate-700 mb-1">Descripción breve (opcional)</label> <textarea class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70 resize-none" rows="3" placeholder="Ej: Participa en la rifa de una cocina a leña comprando desde el 1 al 30 de agosto…"></textarea></div> <div class="flex gap-4 items-end"><div class="flex-1"><label class="block text-xs font-medium text-slate-700 mb-1">Orden (opcional)</label> <input type="number" min="0" class="w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70"/> <p class="mt-1 text-[11px] text-slate-500">Números más bajos se muestran primero.</p></div></div></div> <div class="space-y-3"><div><label class="block text-xs font-medium text-slate-700 mb-1">Imagen de la noticia</label> <input type="file" accept="image/*" class="block w-full text-xs text-slate-600 file:mr-3 file:py-2 file:px-3 file:rounded-lg file:border-0 file:text-xs file:font-medium file:bg-amber-50 file:text-amber-700 hover:file:bg-amber-100"/> <p class="mt-1 text-[11px] text-slate-500">Formatos recomendados: JPG o PNG. Ideal 1200x900 px aprox.</p></div> <!> <div class="mt-2"><button type="submit" class="inline-flex items-center justify-center gap-2 rounded-xl bg-amber-600 text-white px-4 py-2 text-sm font-medium shadow hover:bg-amber-700 active:bg-amber-800 disabled:opacity-60 disabled:cursor-not-allowed"><!></button></div></div></form></div> <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"><h2 class="text-sm font-semibold text-slate-800 mb-3">Noticias existentes</h2> <!></div></section>');function Et(_e,he){Xe(he,!1);let G=u(!0),S=u(!1),m=u([]),U=u(""),O=u(""),k=u(""),te=!0,C=null,b=u(""),g=u(new Set),_=u(new Set);We(ye);async function ye(){n(G,!0);try{n(m,await it())}catch(t){R(String(t?.message??t)),n(m,[])}finally{n(G,!1)}}function we(t){const d=t.currentTarget.files?.[0]??null;C=d,e(b)&&URL.revokeObjectURL(e(b)),n(b,d?URL.createObjectURL(d):"")}async function Se(){if(!C){R("Selecciona una imagen para la noticia.");return}if(!e(S)){n(S,!0);try{const t=await lt({title:e(U).trim()||void 0,caption:e(O).trim()||void 0,file:C,is_active:te,order:e(k)===""?void 0:Number(e(k))});n(m,[t,...e(m)]),ee("Noticia agregada"),n(U,""),n(O,""),n(k,""),te=!0,C=null,e(b)&&(URL.revokeObjectURL(e(b)),n(b,""))}catch(t){R(String(t?.message??t))}finally{n(S,!1)}}}async function ke(t){if(!confirm(`¿Eliminar esta noticia (#${t.id})?`))return;const l=new Set(e(g));l.add(t.id),n(g,l);try{await nt(t.id),n(m,e(m).filter(d=>d.id!==t.id)),ee("Noticia eliminada")}catch(d){R(String(d?.message??d))}finally{const d=new Set(e(g));d.delete(t.id),n(g,d)}}async function Ne(t){const l=!t.is_active,d=new Set(e(_));d.add(t.id),n(_,d);try{const f=await ot(t.id,{is_active:l});n(m,e(m).map(h=>h.id===t.id?f:h)),ee(l?"Noticia activada":"Noticia ocultada")}catch(f){R(String(f?.message??f))}finally{const f=new Set(e(_));f.delete(t.id),n(_,f)}}function je(t){try{return new Date(t).toLocaleString("es-CL",{dateStyle:"short",timeStyle:"short"})}catch{return t}}rt();var P=ht(),z=r(P),ae=o(r(z),2),Le=r(ae);s(ae),s(z);var F=o(z,2),M=o(r(F),2),T=r(M),q=r(T),se=o(r(q),2);ge(se),s(q);var B=o(q,2),re=o(r(B),2);Ze(re),s(B);var ie=o(B,2),le=r(ie),oe=o(r(le),2);ge(oe),Y(2),s(le),s(ie),s(T);var ne=o(T,2),H=r(ne),Ie=o(r(H),2);Y(2),s(H);var de=o(H,2);{var Ae=t=>{var l=dt(),d=r(l);s(l),w(()=>Z(d,"src",e(b))),v(t,l)};x(de,t=>{e(b)&&t(Ae)})}var ce=o(de,2),J=r(ce),Re=r(J);{var Ue=t=>{var l=ct();Y(),v(t,l)},Oe=t=>{var l=I("Guardar noticia");v(t,l)};x(Re,t=>{e(S)?t(Ue):t(Oe,!1)})}s(J),s(ce),s(ne),s(M),s(F);var ve=o(F,2),Ce=o(r(ve),2);{var De=t=>{var l=mt();xe(l,4,()=>Array(6),be,(d,f)=>{var h=vt();v(d,h)}),s(l),v(t,l)},Ee=t=>{var l=et(),d=tt(l);{var f=y=>{var N=pt();v(y,N)},h=y=>{var N=_t();xe(N,5,()=>e(m),be,(Ge,c)=>{var V=gt(),K=r(V),me=r(K);s(K);var Q=o(K,2),pe=r(Q);{var Pe=a=>{var i=ft(),L=r(i,!0);s(i),w(()=>A(L,e(c).title)),v(a,i)};x(pe,a=>{e(c).title&&a(Pe)})}var fe=o(pe,2);{var ze=a=>{var i=ut(),L=r(i,!0);s(i),w(()=>A(L,e(c).caption)),v(a,i)};x(fe,a=>{e(c).caption&&a(ze)})}var W=o(fe,2),Fe=r(W);s(W);var ue=o(W,2),X=r(ue),Me=o(r(X));{var Te=a=>{var i=xt();v(a,i)},qe=a=>{var i=bt();v(a,i)};x(Me,a=>{e(c).is_active?a(Te):a(qe,!1)})}s(X);var j=o(X,2),Be=r(j);{var He=a=>{var i=I("...");v(a,i)},Je=a=>{var i=I();w(()=>A(i,e(c).is_active?"Ocultar":"Activar")),v(a,i)};x(Be,a=>{e(_).has(e(c).id)?a(He):a(Je,!1)})}s(j),s(ue),s(Q);var D=o(Q,2),Ve=r(D);{var Ke=a=>{var i=I("…");v(a,i)},Qe=a=>{var i=I("✕");v(a,i)};x(Ve,a=>{e(g).has(e(c).id)?a(Ke):a(Qe,!1)})}s(D),s(V),w((a,i,L)=>{Z(me,"src",e(c).image),Z(me,"alt",e(c).title||"Noticia"),A(Fe,`#${e(c).id??""} · ${a??""}`),at(j,1,`inline-flex items-center rounded-full px-3 py-0.5 font-medium border text-[11px] transition ${e(c).is_active?"border-slate-300 text-slate-700 hover:bg-slate-100":"border-emerald-500 text-emerald-700 hover:bg-emerald-50"}`),j.disabled=i,D.disabled=L},[()=>je(e(c).created_at),()=>e(_).has(e(c).id)||e(g).has(e(c).id),()=>e(g).has(e(c).id)]),E("click",j,()=>Ne(e(c))),E("click",D,()=>ke(e(c))),v(Ge,V)}),s(N),v(y,N)};x(d,y=>{e(m).length?y(h,!1):y(f)},!0)}v(t,l)};x(Ce,t=>{e(G)?t(De):t(Ee,!1)})}s(ve),s(P),w(()=>{A(Le,`${e(m).length??""} noticia${e(m).length===1?"":"s"} en total`),J.disabled=e(S)}),$(se,()=>e(U),t=>n(U,t)),$(re,()=>e(O),t=>n(O,t)),$(oe,()=>e(k),t=>n(k,t)),E("change",Ie,we),E("submit",M,st(Se)),v(_e,P),Ye()}export{Et as component};
