import"../chunks/DsnmJJEf.js";import"../chunks/luk3gl1z.js";import{o as Ie}from"../chunks/_gNL4IXV.js";import{p as Be,f as w,t as _,d as r,s,g as e,b,c as Fe,A as m,m as U,r as o,y as Oe,x as Ae,e as v,h as Je,n as We,v as De,a as He}from"../chunks/CwLoShKX.js";import{e as k,s as g}from"../chunks/D8bngpjW.js";import{i as X}from"../chunks/WMMc_YU6.js";import{e as Ue,i as Xe}from"../chunks/ThBeqclG.js";import{r as h,s as be}from"../chunks/CkmYFb5S.js";import{b as f}from"../chunks/DGOQ8hUW.js";import{b as Ge}from"../chunks/COJT2EDT.js";import{i as Qe}from"../chunks/Ccxz8Bhd.js";import{s as Ke,a as ve}from"../chunks/DH8C1yjn.js";import{l as fe,c as xe,u as ge,r as Ve,t as Ye}from"../chunks/UF_B8rlF.js";import{g as Ze}from"../chunks/BH5FzZss.js";import{g as et}from"../chunks/5pKeZvy2.js";var tt=w('<p class="mb-3 rounded-lg bg-rose-50 text-rose-700 px-3 py-2 text-sm ring-1 ring-rose-200"> </p>'),at=Je('<svg class="h-4 w-4 animate-spin" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-opacity=".25" stroke-width="3"></circle><path d="M4 12a8 8 0 0 1 8-8v3a5 5 0 0 0-5 5H4z" fill="currentColor"></path></svg> Procesando‚Ä¶',1),st=w('<li class="flex items-start gap-3 pb-4 border-b border-slate-100 last:border-0 last:pb-0"><img class="h-16 w-16 rounded-lg object-cover ring-1 ring-slate-200"/> <div class="flex-1 min-w-0"><div class="text-sm font-medium truncate mb-1"> </div> <div class="text-xs text-slate-500 mb-2"> </div> <div class="flex items-center gap-2"><button type="button" class="h-7 w-7 rounded-lg border border-slate-300 flex items-center justify-center text-slate-600 hover:bg-slate-50 active:scale-95 transition"><svg class="h-3 w-3" viewBox="0 0 24 24" fill="none"><path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg></button> <span class="text-sm font-medium text-slate-900 min-w-[2rem] text-center"> </span> <button type="button" class="h-7 w-7 rounded-lg border border-slate-300 flex items-center justify-center text-slate-600 hover:bg-slate-50 active:scale-95 transition"><svg class="h-3 w-3" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg></button> <button type="button" class="ml-2 text-xs text-rose-600 hover:text-rose-700 hover:underline">Eliminar</button></div></div> <div class="text-sm font-semibold text-slate-900 text-right"> </div></li>'),ot=w('<ul class="space-y-4"></ul> <div class="mt-4 pt-4 border-t border-slate-200 flex items-center justify-between"><span class="text-slate-600 font-medium">Total</span> <b class="text-xl text-slate-900"> </b></div>',1),rt=w('<p class="text-slate-600 text-sm">Tu carrito est√° vac√≠o.</p>'),nt=w(`<section class="mx-auto max-w-5xl px-4 py-10"><h1 class="text-2xl md:text-3xl font-semibold text-amber-800">Checkout</h1> <div class="mt-6 grid gap-6 md:grid-cols-5"><div class="md:col-span-3 rounded-2xl border border-slate-200 bg-white p-4 sm:p-6"><div class="mb-6 rounded-xl bg-amber-50 border border-amber-200 p-4 flex gap-3 items-start"><svg class="w-5 h-5 text-amber-600 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <div><h3 class="text-sm font-bold text-amber-800">Importante: Solo Retiro en Tienda</h3> <p class="text-sm text-amber-700 mt-1">Por el momento <strong>no realizamos env√≠os a domicilio</strong>. 
            Todas las compras deben ser retiradas en nuestro local en <span class="font-semibold">Lautaro 855, Coyhaique</span>.</p></div></div> <h2 class="text-lg font-medium mb-4">Tus datos</h2> <!> <div class="grid sm:grid-cols-2 gap-3"><label class="block"><span class="text-xs text-slate-600">Nombre completo</span> <input class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70" placeholder="Juan P√©rez"/></label> <label class="block"><span class="text-xs text-slate-600">Correo</span> <input type="email" class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70" placeholder="juan@ejemplo.com"/></label> <label class="block"><span class="text-xs text-slate-600">Tel√©fono</span> <input class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70" placeholder="+56 9 1234 5678"/></label> <label class="block sm:col-span-2"><span class="text-xs text-slate-600">Direcci√≥n (para boleta/factura)</span> <input class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70" placeholder="Calle, n√∫mero, comuna..."/></label> <label class="block"><span class="text-xs text-slate-600">Ciudad</span> <input class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70"/></label> <label class="block"><span class="text-xs text-slate-600">Regi√≥n</span> <input class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70"/></label> <div class="sm:col-span-2 mt-2"><span class="text-xs text-slate-600 block mb-1">M√©todo de entrega</span> <div class="rounded-lg border border-amber-200 bg-amber-50/50 p-3 flex items-center gap-3"><div class="h-5 w-5 rounded-full border-[5px] border-amber-600 bg-white"></div> <div class="flex-1"><p class="text-sm font-semibold text-slate-900">Retiro en Tienda</p> <p class="text-xs text-slate-600">Lautaro 855, Coyhaique</p></div> <span class="text-xs font-bold text-emerald-600 uppercase tracking-wide">Gratis</span></div></div> <label class="block sm:col-span-2 mt-2"><span class="text-xs text-slate-600">Notas adicionales</span> <textarea rows="2" class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70" placeholder="¬øQui√©n retira? ¬øAlg√∫n detalle extra?"></textarea></label> <label class="block sm:col-span-2 mt-2"><span class="text-xs text-slate-600">M√©todo de Pago</span> <select class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500/70"><option>Mercado Pago (Tarjetas de cr√©dito/d√©bito)</option><option>Webpay (Pr√≥ximamente)</option></select></label></div> <div class="mt-5"><button type="button" class="inline-flex items-center gap-2 rounded-xl bg-amber-600 text-white px-4 py-2 text-sm font-medium shadow hover:bg-amber-700 disabled:opacity-60"><!></button></div></div> <aside class="md:col-span-2 rounded-2xl border border-slate-200 bg-white p-4 sm:p-6 h-fit"><h2 class="text-lg font-medium mb-4">Tu pedido</h2> <!></aside></div></section>`);function yt(he,_e){Be(_e,!1);const[G,we]=Ke(),Q=()=>ve(xe,"$cart",G),ye=()=>ve(Ye,"$total",G),K="https://tienda-backend-rodrigo.azurewebsites.net".replace(/\/+$/,"");function V(){return typeof document>"u"?"":document.cookie.split("; ").find(a=>a.startsWith("csrftoken="))?.split("=")[1]??""}let t=U({full_name:"",email:"",phone:"",address:"",city:"",region:"",notes:"",payment_method:"mercadopago"}),u=U(!1),p=U("");Ie(fe);function C(a){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(a)}async function ke(){v(p,"");const a=Ze(xe);if(!a||!a.items?.length){v(p,"Tu carrito est√° vac√≠o.");return}if(!e(t).full_name?.trim()||!e(t).email?.trim()){v(p,"Ingresa tu nombre y correo.");return}v(u,!0);try{if(e(t).payment_method==="mercadopago"){const n=await fetch(`${K}/api/checkout/mercadopago/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":V()},body:JSON.stringify({full_name:e(t).full_name,email:e(t).email,phone:e(t).phone,address:e(t).address,city:e(t).city,region:e(t).region,notes:e(t).notes})});if(!n.ok){const c=await n.text();throw console.error("MP error:",c),c.toLowerCase().includes("stock")||c.toLowerCase().includes("insufficient")||c.toLowerCase().includes("insuficiente")?new Error("üòî Lo sentimos, algunos productos en tu carrito ya no tienen stock suficiente. Por favor, revisa las cantidades disponibles."):new Error("No pudimos procesar tu pago en este momento. Por favor, intenta nuevamente o contacta con soporte.")}const d=(await n.json()).init_point;if(!d)throw new Error("Hubo un problema al conectar con Mercado Pago. Por favor, intenta nuevamente.");window.location.href=d;return}if(e(t).payment_method==="transfer"){const n=await fetch(`${K}/api/checkout/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":V()},body:JSON.stringify({full_name:e(t).full_name,email:e(t).email,phone:e(t).phone,address:e(t).address,city:e(t).city,region:e(t).region,notes:e(t).notes,payment_method:"transfer"})});if(!n.ok){const x=await n.text();throw console.error("Checkout error:",x),x.toLowerCase().includes("stock")||x.toLowerCase().includes("insufficient")||x.toLowerCase().includes("insuficiente")?new Error("üòî Lo sentimos, algunos productos en tu carrito ya no tienen stock suficiente. Por favor, revisa las cantidades disponibles."):new Error("No pudimos procesar tu pedido. Por favor, verifica tus datos e intenta nuevamente.")}const i=await n.json(),d=i.order??i,c=d?.number??d?.id;await fe(),et(`/checkout/exito?o=${encodeURIComponent(c??"")}`);return}if(e(t).payment_method==="webpay"){v(p,"Webpay a√∫n est√° en configuraci√≥n. Usa Mercado Pago por ahora.");return}}catch(n){console.error(n),v(p,String(n?.message??n)||"Error al conectar con el servidor.")}finally{v(u,!1)}}Qe();var P=nt(),Y=s(r(P),2),T=r(Y),Z=s(r(T),4);{var Ce=a=>{var n=tt(),i=r(n,!0);o(n),_(()=>g(i,e(p))),b(a,n)};X(Z,a=>{e(p)&&a(Ce)})}var L=s(Z,2),j=r(L),ee=s(r(j),2);h(ee),o(j);var M=s(j,2),te=s(r(M),2);h(te),o(M);var $=s(M,2),ae=s(r($),2);h(ae),o($);var S=s($,2),se=s(r(S),2);h(se),o(S);var E=s(S,2),oe=s(r(E),2);h(oe),o(E);var N=s(E,2),re=s(r(N),2);h(re),o(N);var R=s(N,4),ne=s(r(R),2);Oe(ne),o(R);var le=s(R,2),q=s(r(le),2);_(()=>{e(t),Ae(()=>{})});var z=r(q);z.value=z.__value="mercadopago";var ie=s(z);ie.value=ie.__value="webpay",o(q),o(le),o(L);var ce=s(L,2),y=r(ce),Pe=r(y);{var Te=a=>{var n=at();We(),b(a,n)},Le=a=>{var n=De("Pagar");b(a,n)};X(Pe,a=>{e(u)?a(Te):a(Le,!1)})}o(y),o(ce),o(T);var de=s(T,2),je=s(r(de),2);{var Me=a=>{var n=ot(),i=He(n);Ue(i,5,()=>Q().items,Xe,(I,l)=>{var B=st(),F=r(B),O=s(F,2),A=r(O),Se=r(A,!0);o(A);var J=s(A,2),Ee=r(J);o(J);var me=s(J,2),W=r(me),D=s(W,2),Ne=r(D,!0);o(D);var H=s(D,2),ue=s(H,2);o(me),o(O);var pe=s(O,2),Re=r(pe,!0);o(pe),o(B),_((qe,ze)=>{be(F,"src",e(l).product?.image||"/images/placeholder-product.jpg"),be(F,"alt",e(l).product?.name),g(Se,e(l).product?.name),g(Ee,`${qe??""} c/u`),W.disabled=e(u),g(Ne,e(l).qty),H.disabled=e(u),ue.disabled=e(u),g(Re,ze)},[()=>C(e(l).unit_price),()=>C(e(l).subtotal)]),k("click",W,()=>ge(e(l).id,Math.max(0,e(l).qty-1))),k("click",H,()=>ge(e(l).id,e(l).qty+1)),k("click",ue,()=>Ve(e(l).id)),b(I,B)}),o(i);var d=s(i,2),c=s(r(d),2),x=r(c,!0);o(c),o(d),_(I=>g(x,I),[()=>C(ye())]),b(a,n)},$e=a=>{var n=rt();b(a,n)};X(je,a=>{Q()?.items?.length?a(Me):a($e,!1)})}o(de),o(Y),o(P),_(()=>y.disabled=e(u)),f(ee,()=>e(t).full_name,a=>m(t,e(t).full_name=a)),f(te,()=>e(t).email,a=>m(t,e(t).email=a)),f(ae,()=>e(t).phone,a=>m(t,e(t).phone=a)),f(se,()=>e(t).address,a=>m(t,e(t).address=a)),f(oe,()=>e(t).city,a=>m(t,e(t).city=a)),f(re,()=>e(t).region,a=>m(t,e(t).region=a)),f(ne,()=>e(t).notes,a=>m(t,e(t).notes=a)),Ge(q,()=>e(t).payment_method,a=>m(t,e(t).payment_method=a)),k("click",y,ke),b(he,P),Fe(),we()}export{yt as component};
