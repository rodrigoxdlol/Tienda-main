import"./DsnmJJEf.js";import"./luk3gl1z.js";import{p as X,o as Y,q as Z,f as T,a as ee,b as g,c as te,g as e,m as y,d as c,r as s,s as _,e as o,A as ae,v as H,t as B,u as j,y as re}from"./CwLoShKX.js";import{e as C,s as I}from"./D8bngpjW.js";import{i as P}from"./WMMc_YU6.js";import{e as K,i as L}from"./ThBeqclG.js";import{s as O}from"./DIJ89BUl.js";import{b as se}from"./DGOQ8hUW.js";import{b as oe}from"./ByMdc6nW.js";import{i as ie}from"./Ccxz8Bhd.js";var ne=T("<div><div> </div></div>"),de=T('<button class="text-[10px] px-2 py-1 rounded-full border border-amber-300 bg-amber-50 text-amber-700 hover:bg-amber-100 transition"> </button>'),le=T('<div class="fixed bottom-20 right-4 z-40 w-80 max-h-[70vh] flex flex-col bg-white shadow-2xl rounded-2xl border border-amber-100 overflow-hidden text-sm"><div class="bg-amber-500 text-white px-3 py-2 flex items-center justify-between"><div class="flex items-center gap-2"><span class="text-lg">üßë‚Äçüç≥</span> <div class="flex flex-col leading-tight"><span class="font-semibold text-sm">Asistente Cocinas</span> <span class="text-xs opacity-90">Responde dudas r√°pidas</span></div></div> <span class="text-[10px] bg-white/20 px-2 py-0.5 rounded-full">Bot gratuito</span></div> <div class="flex-1 overflow-y-auto p-3 space-y-2 bg-gradient-to-b from-gray-50 to-white"></div> <div class="px-2 pb-1 bg-white border-t border-gray-100"><div class="flex flex-wrap gap-1"></div></div> <div class="border-t border-gray-200 bg-white p-2 flex items-center gap-2"><textarea class="flex-1 resize-none border border-gray-300 rounded-lg px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-amber-400" rows="1" placeholder="Escribe tu pregunta..."></textarea> <button class="px-3 py-1 rounded-lg bg-amber-500 text-white text-xs font-semibold disabled:opacity-50"> </button></div></div>'),ce=T('<button class="fixed bottom-4 right-4 z-40 flex items-center justify-center w-14 h-14 rounded-full bg-amber-500 shadow-lg hover:bg-amber-400 transition active:scale-95 text-white" aria-label="Abrir chat de ayuda"><!></button> <!>',1);function _e(Q,q){X(q,!1);let u=y(!1),i=y([{from:"bot",text:"¬°Hola! Soy el asistente de la tienda de cocinas üßë‚Äçüç≥. ¬øEn qu√© te puedo ayudar?"}]),f=y(""),p=y(!1);const D="http://127.0.0.1:8000",J=["¬øCu√°l es el horario de atenci√≥n?","¬øInstalan las cocinas?","¬øQu√© m√©todos de pago aceptan?","¬øTienen garant√≠a?","¬øTienen tienda f√≠sica?","¬øC√≥mo puedo contactar con ustedes?"];async function A(t){const r=(t??e(f)).trim();if(!(!r||e(p))){o(i,[...e(i),{from:"user",text:r}]),t||o(f,""),o(p,!0);try{const a=await fetch(`${D}/api/chatbot/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r}),credentials:"include"});if(!a.ok){let m=null;try{m=await a.json()}catch{}if(a.status===429){const x=m?.detail||"Has enviado muchas preguntas seguidas ü§Ø. Espera un momento y vuelve a intentarlo.";o(i,[...e(i),{from:"bot",text:x}]);return}const v=m?.detail||"Lo siento, hubo un problema al responder (error en la API).";throw new Error(v)}const E=(await a.json()).answer??"Lo siento, hubo un problema al responder.";o(i,[...e(i),{from:"bot",text:E}]),S()}catch(a){console.error(a),o(i,[...e(i),{from:"bot",text:a instanceof Error?a.message:"Ups, hubo un error al conectar con el servidor üò¢. Intenta de nuevo en un momento."}])}finally{o(p,!1),S()}}}function M(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),A())}function N(t){A(t)}let b=y();function S(){e(b)&&setTimeout(()=>{ae(b,e(b).scrollTop=e(b).scrollHeight)},0)}Y(()=>e(u),()=>{e(u)&&S()}),Z(),ie();var z=ce(),w=ee(z),R=c(w);{var U=t=>{var r=H("‚úï");g(t,r)},$=t=>{var r=H("üí¨");g(t,r)};P(R,t=>{e(u)?t(U):t($,!1)})}s(w);var F=_(w,2);{var G=t=>{var r=le(),a=_(c(r),2);K(a,5,()=>e(i),L,(n,d)=>{var l=ne(),h=c(l),W=c(h,!0);s(h),s(l),B(()=>{O(l,1,`flex ${e(d),j(()=>e(d).from==="user"?"justify-end":"justify-start")??""}`),O(h,1,(e(d),j(()=>`px-3 py-2 rounded-2xl max-w-[80%] whitespace-pre-wrap text-xs sm:text-sm ${e(d).from==="user"?"bg-amber-500 text-white rounded-br-sm":"bg-white text-gray-900 border border-gray-200 rounded-bl-sm"}`))),I(W,(e(d),j(()=>e(d).text)))}),g(n,l)}),s(a),oe(a,n=>o(b,n),()=>e(b));var k=_(a,2),E=c(k);K(E,5,()=>J,L,(n,d)=>{var l=de(),h=c(l,!0);s(l),B(()=>I(h,e(d))),C("click",l,()=>N(e(d))),g(n,l)}),s(E),s(k);var m=_(k,2),v=c(m);re(v);var x=_(v,2),V=c(x,!0);s(x),s(m),s(r),B(n=>{x.disabled=n,I(V,e(p)?"...":"Enviar")},[()=>(e(p),e(f),j(()=>e(p)||!e(f).trim()))]),se(v,()=>e(f),n=>o(f,n)),C("keydown",v,M),C("click",x,()=>A()),g(t,r)};P(F,t=>{e(u)&&t(G)})}C("click",w,()=>o(u,!e(u))),g(Q,z),te()}export{_e as C};
